import{_ as pn,d as xr,r as hn,m as vn,y as gn,o as Ir,e as Nr,w as Ye,g as Lr,b as mn,D as bn,u as wn}from"./index.3b9b839b.js";const yn=["white","black"],rr=["a","b","c","d","e","f","g","h"],nr=["1","2","3","4","5","6","7","8"],_n=[...nr].reverse(),tr=Array.prototype.concat(...rr.map(e=>nr.map(r=>e+r))),V=e=>tr[8*e[0]+e[1]],N=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],qr=tr.map(N);function Sn(e){let r;const n=()=>(r===void 0&&(r=e()),r);return n.clear=()=>{r=void 0},n}const Cn=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const r=performance.now()-e;return e=void 0,r}}},or=e=>e==="white"?"black":"white",qe=(e,r)=>{const n=e[0]-r[0],t=e[1]-r[1];return n*n+t*t},Xe=(e,r)=>e.role===r.role&&e.color===r.color,Oe=e=>(r,n)=>[(n?r[0]:7-r[0])*e.width/8,(n?7-r[1]:r[1])*e.height/8],ie=(e,r)=>{e.style.transform=`translate(${r[0]}px,${r[1]}px)`},Dr=(e,r,n=1)=>{e.style.transform=`translate(${r[0]}px,${r[1]}px) scale(${n})`},ir=(e,r)=>{e.style.visibility=r?"visible":"hidden"},Ce=e=>{var r;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((r=e.targetTouches)===null||r===void 0)&&r[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},Or=e=>e.buttons===2||e.button===2,le=(e,r)=>{const n=document.createElement(e);return r&&(n.className=r),n};function Kr(e,r,n){const t=N(e);return r||(t[0]=7-t[0],t[1]=7-t[1]),[n.left+n.width*t[0]/8+n.width/16,n.top+n.height*(7-t[1])/8+n.height/16]}function Se(e,r){return Math.abs(e-r)}function kn(e){return(r,n,t,o)=>Se(r,t)<2&&(e==="white"?o===n+1||n<=1&&o===n+2&&r===t:o===n-1||n>=6&&o===n-2&&r===t)}const $r=(e,r,n,t)=>{const o=Se(e,n),a=Se(r,t);return o===1&&a===2||o===2&&a===1},Br=(e,r,n,t)=>Se(e,n)===Se(r,t),Ur=(e,r,n,t)=>e===n||r===t,Qr=(e,r,n,t)=>Br(e,r,n,t)||Ur(e,r,n,t);function Pn(e,r,n){return(t,o,a,s)=>Se(t,a)<2&&Se(o,s)<2||n&&o===s&&o===(e==="white"?0:7)&&(t===4&&(a===2&&r.includes(0)||a===6&&r.includes(7))||r.includes(a))}function En(e,r){const n=r==="white"?"1":"8",t=[];for(const[o,a]of e)o[1]===n&&a.color===r&&a.role==="rook"&&t.push(N(o)[0]);return t}function Wr(e,r,n){const t=e.get(r);if(!t)return[];const o=N(r),a=t.role,s=a==="pawn"?kn(t.color):a==="knight"?$r:a==="bishop"?Br:a==="rook"?Ur:a==="queen"?Qr:Pn(t.color,En(e,t.color),n);return qr.filter(f=>(o[0]!==f[0]||o[1]!==f[1])&&s(o[0],o[1],f[0],f[1])).map(V)}function F(e,...r){e&&setTimeout(()=>e(...r),1)}function An(e){e.orientation=or(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Tn(e,r){for(const[n,t]of r)t?e.pieces.set(n,t):e.pieces.delete(n)}function Mn(e,r){if(e.check=void 0,r===!0&&(r=e.turnColor),r)for(const[n,t]of e.pieces)t.role==="king"&&t.color===r&&(e.check=n)}function Rn(e,r,n,t){be(e),e.premovable.current=[r,n],F(e.premovable.events.set,r,n,t)}function me(e){e.premovable.current&&(e.premovable.current=void 0,F(e.premovable.events.unset))}function xn(e,r,n){me(e),e.predroppable.current={role:r,key:n},F(e.predroppable.events.set,r,n)}function be(e){const r=e.predroppable;r.current&&(r.current=void 0,F(r.events.unset))}function In(e,r,n){if(!e.autoCastle)return!1;const t=e.pieces.get(r);if(!t||t.role!=="king")return!1;const o=N(r),a=N(n);if(o[1]!==0&&o[1]!==7||o[1]!==a[1])return!1;o[0]===4&&!e.pieces.has(n)&&(a[0]===6?n=V([7,a[1]]):a[0]===2&&(n=V([0,a[1]])));const s=e.pieces.get(n);return!s||s.color!==t.color||s.role!=="rook"?!1:(e.pieces.delete(r),e.pieces.delete(n),o[0]<a[0]?(e.pieces.set(V([6,a[1]]),t),e.pieces.set(V([5,a[1]]),s)):(e.pieces.set(V([2,a[1]]),t),e.pieces.set(V([3,a[1]]),s)),!0)}function Hr(e,r,n){const t=e.pieces.get(r),o=e.pieces.get(n);if(r===n||!t)return!1;const a=o&&o.color!==t.color?o:void 0;return n===e.selected&&Z(e),F(e.events.move,r,n,a),In(e,r,n)||(e.pieces.set(n,t),e.pieces.delete(r)),e.lastMove=[r,n],e.check=void 0,F(e.events.change),a||!0}function ar(e,r,n,t){if(e.pieces.has(n))if(t)e.pieces.delete(n);else return!1;return F(e.events.dropNewPiece,r,n),e.pieces.set(n,r),e.lastMove=[n],e.check=void 0,F(e.events.change),e.movable.dests=void 0,e.turnColor=or(e.turnColor),!0}function Fr(e,r,n){const t=Hr(e,r,n);return t&&(e.movable.dests=void 0,e.turnColor=or(e.turnColor),e.animation.current=void 0),t}function zr(e,r,n){if(lr(e,r,n)){const t=Fr(e,r,n);if(t){const o=e.hold.stop();Z(e);const a={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return t!==!0&&(a.captured=t),F(e.movable.events.after,r,n,a),!0}}else if(Ln(e,r,n))return Rn(e,r,n,{ctrlKey:e.stats.ctrlKey}),Z(e),!0;return Z(e),!1}function jr(e,r,n,t){const o=e.pieces.get(r);o&&(Nn(e,r,n)||t)?(e.pieces.delete(r),ar(e,o,n,t),F(e.movable.events.afterNewPiece,o.role,n,{premove:!1,predrop:!1})):o&&qn(e,r,n)?xn(e,o.role,n):(me(e),be(e)),e.pieces.delete(r),Z(e)}function Je(e,r,n){if(F(e.events.select,r),e.selected){if(e.selected===r&&!e.draggable.enabled){Z(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==r&&zr(e,e.selected,r)){e.stats.dragged=!1;return}}(Vr(e,r)||cr(e,r))&&(Gr(e,r),e.hold.start())}function Gr(e,r){e.selected=r,cr(e,r)?e.premovable.dests=Wr(e.pieces,r,e.premovable.castle):e.premovable.dests=void 0}function Z(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function Vr(e,r){const n=e.pieces.get(r);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}function lr(e,r,n){var t,o;return r!==n&&Vr(e,r)&&(e.movable.free||!!(!((o=(t=e.movable.dests)===null||t===void 0?void 0:t.get(r))===null||o===void 0)&&o.includes(n)))}function Nn(e,r,n){const t=e.pieces.get(r);return!!t&&(r===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===t.color&&e.turnColor===t.color)}function cr(e,r){const n=e.pieces.get(r);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function Ln(e,r,n){return r!==n&&cr(e,r)&&Wr(e.pieces,r,e.premovable.castle).includes(n)}function qn(e,r,n){const t=e.pieces.get(r),o=e.pieces.get(n);return!!t&&(!o||o.color!==e.movable.color)&&e.predroppable.enabled&&(t.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===t.color&&e.turnColor!==t.color}function Dn(e,r){const n=e.pieces.get(r);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function On(e){const r=e.premovable.current;if(!r)return!1;const n=r[0],t=r[1];let o=!1;if(lr(e,n,t)){const a=Fr(e,n,t);if(a){const s={premove:!0};a!==!0&&(s.captured=a),F(e.movable.events.after,n,t,s),o=!0}}return me(e),o}function Kn(e,r){const n=e.predroppable.current;let t=!1;if(!n)return!1;if(r(n)){const o={role:n.role,color:e.movable.color};ar(e,o,n.key)&&(F(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),t=!0)}return be(e),t}function sr(e){me(e),be(e),Z(e)}function gr(e){e.movable.color=e.movable.dests=e.animation.current=void 0,sr(e)}function ke(e,r,n){let t=Math.floor(8*(e[0]-n.left)/n.width);r||(t=7-t);let o=7-Math.floor(8*(e[1]-n.top)/n.height);return r||(o=7-o),t>=0&&t<8&&o>=0&&o<8?V([t,o]):void 0}function $n(e,r,n,t){const o=N(e),a=qr.filter(p=>Qr(o[0],o[1],p[0],p[1])||$r(o[0],o[1],p[0],p[1])),f=a.map(p=>Kr(V(p),n,t)).map(p=>qe(r,p)),[,v]=f.reduce((p,b,g)=>p[0]<b?p:[b,g],[f[0],0]);return V(a[v])}function z(e){return e.orientation==="white"}const Zr="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Bn={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Un={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function Yr(e){e==="start"&&(e=Zr);const r=new Map;let n=7,t=0;for(const o of e)switch(o){case" ":case"[":return r;case"/":if(--n,n<0)return r;t=0;break;case"~":{const a=r.get(V([t-1,n]));a&&(a.promoted=!0);break}default:{const a=o.charCodeAt(0);if(a<57)t+=a-48;else{const s=o.toLowerCase();r.set(V([t,n]),{role:Bn[s],color:o===s?"black":"white"}),++t}}}return r}function Qn(e){return _n.map(r=>rr.map(n=>{const t=e.get(n+r);if(t){let o=Un[t.role];return t.color==="white"&&(o=o.toUpperCase()),t.promoted&&(o+="~"),o}else return"1"}).join("")).join("/").replace(/1{2,}/g,r=>r.length.toString())}function Xr(e,r){r.animation&&(ur(e.animation,r.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Jr(e,r){var n,t;if(!((n=r.movable)===null||n===void 0)&&n.dests&&(e.movable.dests=void 0),!((t=r.drawable)===null||t===void 0)&&t.autoShapes&&(e.drawable.autoShapes=[]),ur(e,r),r.fen&&(e.pieces=Yr(r.fen),e.drawable.shapes=[]),"check"in r&&Mn(e,r.check||!1),"lastMove"in r&&!r.lastMove?e.lastMove=void 0:r.lastMove&&(e.lastMove=r.lastMove),e.selected&&Gr(e,e.selected),Xr(e,r),!e.movable.rookCastle&&e.movable.dests){const o=e.movable.color==="white"?"1":"8",a="e"+o,s=e.movable.dests.get(a),f=e.pieces.get(a);if(!s||!f||f.role!=="king")return;e.movable.dests.set(a,s.filter(v=>!(v==="a"+o&&s.includes("c"+o))&&!(v==="h"+o&&s.includes("g"+o))))}}function ur(e,r){for(const n in r)mr(e[n])&&mr(r[n])?ur(e[n],r[n]):e[n]=r[n]}function mr(e){return typeof e=="object"}function _e(e,r){return r.animation.enabled?Fn(e,r):pe(e,r)}function pe(e,r){const n=e(r);return r.dom.redraw(),n}function ze(e,r){return{key:e,pos:N(e),piece:r}}function Wn(e,r){return r.sort((n,t)=>qe(e.pos,n.pos)-qe(e.pos,t.pos))[0]}function Hn(e,r){const n=new Map,t=[],o=new Map,a=[],s=[],f=new Map;let v,p,b;for(const[g,E]of e)f.set(g,ze(g,E));for(const g of tr)v=r.pieces.get(g),p=f.get(g),v?p?Xe(v,p.piece)||(a.push(p),s.push(ze(g,v))):s.push(ze(g,v)):p&&a.push(p);for(const g of s)p=Wn(g,a.filter(E=>Xe(g.piece,E.piece))),p&&(b=[p.pos[0]-g.pos[0],p.pos[1]-g.pos[1]],n.set(g.key,b.concat(b)),t.push(p.key));for(const g of a)t.includes(g.key)||o.set(g.key,g.piece);return{anims:n,fadings:o}}function en(e,r){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const t=1-(r-n.start)*n.frequency;if(t<=0)e.animation.current=void 0,e.dom.redrawNow();else{const o=zn(t);for(const a of n.plan.anims.values())a[2]=a[0]*o,a[3]=a[1]*o;e.dom.redrawNow(!0),requestAnimationFrame((a=performance.now())=>en(e,a))}}function Fn(e,r){const n=new Map(r.pieces),t=e(r),o=Hn(n,r);if(o.anims.size||o.fadings.size){const a=r.animation.current&&r.animation.current.start;r.animation.current={start:performance.now(),frequency:1/r.animation.duration,plan:o},a||en(r,performance.now())}else r.dom.redraw();return t}function zn(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}const jn=["green","red","blue","yellow"];function Gn(e,r){if(r.touches&&r.touches.length>1)return;r.stopPropagation(),r.preventDefault(),r.ctrlKey?Z(e):sr(e);const n=Ce(r),t=ke(n,z(e),e.dom.bounds());!t||(e.drawable.current={orig:t,pos:n,brush:Xn(r),snapToValidMove:e.drawable.defaultSnapToValidMove},rn(e))}function rn(e){requestAnimationFrame(()=>{const r=e.drawable.current;if(r){const n=ke(r.pos,z(e),e.dom.bounds());n||(r.snapToValidMove=!1);const t=r.snapToValidMove?$n(r.orig,r.pos,z(e),e.dom.bounds()):n;t!==r.mouseSq&&(r.mouseSq=t,r.dest=t!==r.orig?t:void 0,e.dom.redrawNow()),rn(e)}})}function Vn(e,r){e.drawable.current&&(e.drawable.current.pos=Ce(r))}function Zn(e){const r=e.drawable.current;r&&(r.mouseSq&&Jn(e.drawable,r),nn(e))}function nn(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Yn(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),tn(e.drawable))}function Xn(e){var r;const n=(e.shiftKey||e.ctrlKey)&&Or(e),t=e.altKey||e.metaKey||((r=e.getModifierState)===null||r===void 0?void 0:r.call(e,"AltGraph"));return jn[(n?1:0)+(t?2:0)]}function Jn(e,r){const n=o=>o.orig===r.orig&&o.dest===r.dest,t=e.shapes.find(n);t&&(e.shapes=e.shapes.filter(o=>!n(o))),(!t||t.brush!==r.brush)&&e.shapes.push(r),tn(e)}function tn(e){e.onChange&&e.onChange(e.shapes)}function et(e,r){if(!r.isTrusted||r.button!==void 0&&r.button!==0||r.touches&&r.touches.length>1)return;const n=e.dom.bounds(),t=Ce(r),o=ke(t,z(e),n);if(!o)return;const a=e.pieces.get(o),s=e.selected;!s&&e.drawable.enabled&&(e.drawable.eraseOnClick||!a||a.color!==e.turnColor)&&Yn(e),r.cancelable!==!1&&(!r.touches||e.blockTouchScroll||a||s||rt(e,t))&&r.preventDefault();const f=!!e.premovable.current,v=!!e.predroppable.current;e.stats.ctrlKey=r.ctrlKey,e.selected&&lr(e,e.selected,o)?_e(g=>Je(g,o),e):Je(e,o);const p=e.selected===o,b=an(e,o);if(a&&b&&p&&Dn(e,o)){e.draggable.current={orig:o,piece:a,origPos:t,pos:t,started:e.draggable.autoDistance&&e.stats.dragged,element:b,previouslySelected:s,originTarget:r.target,keyHasChanged:!1},b.cgDragging=!0,b.classList.add("dragging");const g=e.dom.elements.ghost;g&&(g.className=`ghost ${a.color} ${a.role}`,ie(g,Oe(n)(N(o),z(e))),ir(g,!0)),fr(e)}else f&&me(e),v&&be(e);e.dom.redraw()}function rt(e,r){const n=z(e),t=e.dom.bounds(),o=Math.pow(t.width/8,2);for(const a of e.pieces.keys()){const s=Kr(a,n,t);if(qe(s,r)<=o)return!0}return!1}function nt(e,r,n,t){const o="a0";e.pieces.set(o,r),e.dom.redraw();const a=Ce(n);e.draggable.current={orig:o,piece:r,origPos:a,pos:a,started:!0,element:()=>an(e,o),originTarget:n.target,newPiece:!0,force:!!t,keyHasChanged:!1},fr(e)}function fr(e){requestAnimationFrame(()=>{var r;const n=e.draggable.current;if(!n)return;!((r=e.animation.current)===null||r===void 0)&&r.plan.anims.has(n.orig)&&(e.animation.current=void 0);const t=e.pieces.get(n.orig);if(!t||!Xe(t,n.piece))Ue(e);else if(!n.started&&qe(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const a=n.element();if(!a)return;a.cgDragging=!0,a.classList.add("dragging"),n.element=a}const o=e.dom.bounds();ie(n.element,[n.pos[0]-o.left-o.width/16,n.pos[1]-o.top-o.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==ke(n.pos,z(e),o))}fr(e)})}function tt(e,r){e.draggable.current&&(!r.touches||r.touches.length<2)&&(e.draggable.current.pos=Ce(r))}function ot(e,r){const n=e.draggable.current;if(!n)return;if(r.type==="touchend"&&r.cancelable!==!1&&r.preventDefault(),r.type==="touchend"&&n.originTarget!==r.target&&!n.newPiece){e.draggable.current=void 0;return}me(e),be(e);const t=Ce(r)||n.pos,o=ke(t,z(e),e.dom.bounds());o&&n.started&&n.orig!==o?n.newPiece?jr(e,n.orig,o,n.force):(e.stats.ctrlKey=r.ctrlKey,zr(e,n.orig,o)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!o&&(e.pieces.delete(n.orig),F(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===o||!o)?Z(e):e.selectable.enabled||Z(e),on(e),e.draggable.current=void 0,e.dom.redraw()}function Ue(e){const r=e.draggable.current;r&&(r.newPiece&&e.pieces.delete(r.orig),e.draggable.current=void 0,Z(e),on(e),e.dom.redraw())}function on(e){const r=e.dom.elements;r.ghost&&ir(r.ghost,!1)}function an(e,r){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===r&&n.tagName==="PIECE")return n;n=n.nextSibling}}function it(e,r){e.exploding={stage:1,keys:r},e.dom.redraw(),setTimeout(()=>{br(e,2),setTimeout(()=>br(e,void 0),120)},120)}function br(e,r){e.exploding&&(r?e.exploding.stage=r:e.exploding=void 0,e.dom.redraw())}function at(e,r){function n(){An(e),r()}return{set(t){t.orientation&&t.orientation!==e.orientation&&n(),Xr(e,t),(t.fen?_e:pe)(o=>Jr(o,t),e)},state:e,getFen:()=>Qn(e.pieces),toggleOrientation:n,setPieces(t){_e(o=>Tn(o,t),e)},selectSquare(t,o){t?_e(a=>Je(a,t,o),e):e.selected&&(Z(e),e.dom.redraw())},move(t,o){_e(a=>Hr(a,t,o),e)},newPiece(t,o){_e(a=>ar(a,t,o),e)},playPremove(){if(e.premovable.current){if(_e(On,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const o=Kn(e,t);return e.dom.redraw(),o}return!1},cancelPremove(){pe(me,e)},cancelPredrop(){pe(be,e)},cancelMove(){pe(t=>{sr(t),Ue(t)},e)},stop(){pe(t=>{gr(t),Ue(t)},e)},explode(t){it(e,t)},setAutoShapes(t){pe(o=>o.drawable.autoShapes=t,e)},setShapes(t){pe(o=>o.drawable.shapes=t,e)},getKeyAtDomPos(t){return ke(t,z(e),e.dom.bounds())},redrawAll:r,dragNewPiece(t,o,a){nt(e,t,o,a)},destroy(){gr(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function lt(){return{pieces:Yr(Zr),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,addDimensionsCssVars:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:Cn()}}function er(e,r,n){const t=new Map,o=[];for(const f of e)t.set(f.hash,!1);let a=r.firstChild,s;for(;a;)s=a.getAttribute("cgHash"),t.has(s)?t.set(s,!0):o.push(a),a=a.nextSibling;for(const f of o)r.removeChild(f);for(const f of e)t.get(f.hash)||r.appendChild(n(f))}function J(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function ct(e,r,n){const t=e.drawable,o=t.current,a=o&&o.mouseSq?o:void 0,s=new Map,f=e.dom.bounds(),v=t.autoShapes.filter(w=>!w.piece);for(const w of t.shapes.concat(v).concat(a?[a]:[]))w.dest&&s.set(w.dest,(s.get(w.dest)||0)+1);const p=t.shapes.concat(v).map(w=>({shape:w,current:!1,hash:wr(w,s,!1,f)}));a&&p.push({shape:a,current:!0,hash:wr(a,s,!0,f)});const b=p.map(w=>w.hash).join(";");if(b===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=b;const g=r.querySelector("defs"),E=r.querySelector("g"),L=n.querySelector("g");st(t,p,g),er(p.filter(w=>!w.shape.customSvg),E,w=>yr(e,w,t.brushes,s,f)),er(p.filter(w=>w.shape.customSvg),L,w=>yr(e,w,t.brushes,s,f))}function st(e,r,n){const t=new Map;let o;for(const f of r)f.shape.dest&&(o=e.brushes[f.shape.brush],f.shape.modifiers&&(o=ln(o,f.shape.modifiers)),t.set(o.key,o));const a=new Set;let s=n.firstChild;for(;s;)a.add(s.getAttribute("cgKey")),s=s.nextSibling;for(const[f,v]of t.entries())a.has(f)||n.appendChild(gt(v))}function wr({orig:e,dest:r,brush:n,piece:t,modifiers:o,customSvg:a},s,f,v){return[v.width,v.height,f,e,r,n,r&&(s.get(r)||0)>1,t&&ut(t),o&&ft(o),a&&dt(a)].filter(p=>p).join(",")}function ut(e){return[e.color,e.role,e.scale].filter(r=>r).join(",")}function ft(e){return""+(e.lineWidth||"")}function dt(e){let r=0;for(let n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n)>>>0;return"custom-"+r.toString()}function yr(e,{shape:r,current:n,hash:t},o,a,s){let f;const v=_r(N(r.orig),e.orientation);if(r.customSvg)f=pt(r.customSvg,v,s);else if(r.dest){let p=o[r.brush];r.modifiers&&(p=ln(p,r.modifiers)),f=vt(p,v,_r(N(r.dest),e.orientation),n,(a.get(r.dest)||0)>1,s)}else f=ht(o[r.brush],v,n,s);return f.setAttribute("cgHash",t),f}function pt(e,r,n){const[t,o]=Qe(r,n),a=ge(J("g"),{transform:`translate(${t},${o})`}),s=ge(J("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return a.appendChild(s),s.innerHTML=e,a}function ht(e,r,n,t){const o=Qe(r,t),a=mt(),s=(t.width+t.height)/(4*Math.max(t.width,t.height));return ge(J("circle"),{stroke:e.color,"stroke-width":a[n?0:1],fill:"none",opacity:cn(e,n),cx:o[0],cy:o[1],r:s-a[1]/2})}function vt(e,r,n,t,o,a){const s=wt(o&&!t),f=Qe(r,a),v=Qe(n,a),p=v[0]-f[0],b=v[1]-f[1],g=Math.atan2(b,p),E=Math.cos(g)*s,L=Math.sin(g)*s;return ge(J("line"),{stroke:e.color,"stroke-width":bt(e,t),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:cn(e,t),x1:f[0],y1:f[1],x2:v[0]-E,y2:v[1]-L})}function gt(e){const r=ge(J("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return r.appendChild(ge(J("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),r.setAttribute("cgKey",e.key),r}function ge(e,r){for(const n in r)e.setAttribute(n,r[n]);return e}function _r(e,r){return r==="white"?e:[7-e[0],7-e[1]]}function ln(e,r){return{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(r.lineWidth||e.lineWidth),key:[e.key,r.lineWidth].filter(n=>n).join("")}}function mt(){return[3/64,4/64]}function bt(e,r){return(e.lineWidth||10)*(r?.85:1)/64}function cn(e,r){return(e.opacity||1)*(r?.9:1)}function wt(e){return(e?20:10)/64}function Qe(e,r){const n=Math.min(1,r.width/r.height),t=Math.min(1,r.height/r.width);return[(e[0]-3.5)*n,(3.5-e[1])*t]}function yt(e,r){e.innerHTML="",e.classList.add("cg-wrap");for(const v of yn)e.classList.toggle("orientation-"+v,r.orientation===v);e.classList.toggle("manipulable",!r.viewOnly);const n=le("cg-container");e.appendChild(n);const t=le("cg-board");n.appendChild(t);let o,a,s;if(r.drawable.visible&&(o=ge(J("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(J("defs")),o.appendChild(J("g")),a=ge(J("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),a.appendChild(J("g")),s=le("cg-auto-pieces"),n.appendChild(o),n.appendChild(a),n.appendChild(s)),r.coordinates){const v=r.orientation==="black"?" black":"",p=r.ranksPosition==="left"?" left":"";n.appendChild(Sr(nr,"ranks"+v+p)),n.appendChild(Sr(rr,"files"+v))}let f;return r.draggable.showGhost&&(f=le("piece","ghost"),ir(f,!1),n.appendChild(f)),{board:t,container:n,wrap:e,ghost:f,svg:o,customSvg:a,autoPieces:s}}function Sr(e,r){const n=le("coords",r);let t;for(const o of e)t=le("coord"),t.textContent=o,n.appendChild(t);return n}function _t(e,r){if(!e.dropmode.active)return;me(e),be(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const t=Ce(r),o=t&&ke(t,z(e),e.dom.bounds());o&&jr(e,"a0",o)}e.dom.redraw()}function St(e,r){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(r).observe(e.dom.elements.wrap),e.viewOnly)return;const t=kt(e);n.addEventListener("touchstart",t,{passive:!1}),n.addEventListener("mousedown",t,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",o=>o.preventDefault())}function Ct(e,r){const n=[];if("ResizeObserver"in window||n.push(Ie(document.body,"chessground.resize",r)),!e.viewOnly){const t=Cr(e,tt,Vn),o=Cr(e,ot,Zn);for(const s of["touchmove","mousemove"])n.push(Ie(document,s,t));for(const s of["touchend","mouseup"])n.push(Ie(document,s,o));const a=()=>e.dom.bounds.clear();n.push(Ie(document,"scroll",a,{capture:!0,passive:!0})),n.push(Ie(window,"resize",a,{passive:!0}))}return()=>n.forEach(t=>t())}function Ie(e,r,n,t){return e.addEventListener(r,n,t),()=>e.removeEventListener(r,n,t)}function kt(e){return r=>{e.draggable.current?Ue(e):e.drawable.current?nn(e):r.shiftKey||Or(r)?e.drawable.enabled&&Gn(e,r):e.viewOnly||(e.dropmode.active?_t(e,r):et(e,r))}}function Cr(e,r,n){return t=>{e.drawable.current?e.drawable.enabled&&n(e,t):e.viewOnly||r(e,t)}}function Pt(e){const r=z(e),n=Oe(e.dom.bounds()),t=e.dom.elements.board,o=e.pieces,a=e.animation.current,s=a?a.plan.anims:new Map,f=a?a.plan.fadings:new Map,v=e.draggable.current,p=At(e),b=new Set,g=new Set,E=new Map,L=new Map;let w,S,q,ee,$,ce,Pe,G,Ee,B;for(S=t.firstChild;S;){if(w=S.cgKey,sn(S))if(q=o.get(w),$=s.get(w),ce=f.get(w),ee=S.cgPiece,S.cgDragging&&(!v||v.orig!==w)&&(S.classList.remove("dragging"),ie(S,n(N(w),r)),S.cgDragging=!1),!ce&&S.cgFading&&(S.cgFading=!1,S.classList.remove("fading")),q){if($&&S.cgAnimating&&ee===Ne(q)){const T=N(w);T[0]+=$[2],T[1]+=$[3],S.classList.add("anim"),ie(S,n(T,r))}else S.cgAnimating&&(S.cgAnimating=!1,S.classList.remove("anim"),ie(S,n(N(w),r)),e.addPieceZIndex&&(S.style.zIndex=je(N(w),r)));ee===Ne(q)&&(!ce||!S.cgFading)?b.add(w):ce&&ee===Ne(ce)?(S.classList.add("fading"),S.cgFading=!0):Ge(E,ee,S)}else Ge(E,ee,S);else if(un(S)){const T=S.className;p.get(w)===T?g.add(w):Ge(L,T,S)}S=S.nextSibling}for(const[T,j]of p)if(!g.has(T)){Ee=L.get(j),B=Ee&&Ee.pop();const W=n(N(T),r);if(B)B.cgKey=T,ie(B,W);else{const U=le("square",j);U.cgKey=T,ie(U,W),t.insertBefore(U,t.firstChild)}}for(const[T,j]of o)if($=s.get(T),!b.has(T))if(Pe=E.get(Ne(j)),G=Pe&&Pe.pop(),G){G.cgKey=T,G.cgFading&&(G.classList.remove("fading"),G.cgFading=!1);const W=N(T);e.addPieceZIndex&&(G.style.zIndex=je(W,r)),$&&(G.cgAnimating=!0,G.classList.add("anim"),W[0]+=$[2],W[1]+=$[3]),ie(G,n(W,r))}else{const W=Ne(j),U=le("piece",W),se=N(T);U.cgPiece=W,U.cgKey=T,$&&(U.cgAnimating=!0,se[0]+=$[2],se[1]+=$[3]),ie(U,n(se,r)),e.addPieceZIndex&&(U.style.zIndex=je(se,r)),t.appendChild(U)}for(const T of E.values())Pr(e,T);for(const T of L.values())Pr(e,T)}function Et(e){const r=z(e),n=Oe(e.dom.bounds());let t=e.dom.elements.board.firstChild;for(;t;)(sn(t)&&!t.cgAnimating||un(t))&&ie(t,n(N(t.cgKey),r)),t=t.nextSibling}function kr(e){const r=e.dom.elements.wrap.getBoundingClientRect(),n=e.dom.elements.container,t=r.height/r.width,o=Math.floor(r.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,a=o*t;n.style.width=o+"px",n.style.height=a+"px",e.dom.bounds.clear(),e.addDimensionsCssVars&&(document.documentElement.style.setProperty("--cg-width",o+"px"),document.documentElement.style.setProperty("--cg-height",a+"px"))}function sn(e){return e.tagName==="PIECE"}function un(e){return e.tagName==="SQUARE"}function Pr(e,r){for(const n of r)e.dom.elements.board.removeChild(n)}function je(e,r){const t=e[1];return`${r?3+7-t:3+t}`}function Ne(e){return`${e.color} ${e.role}`}function At(e){var r;const n=new Map;if(e.lastMove&&e.highlight.lastMove)for(const a of e.lastMove)fe(n,a,"last-move");if(e.check&&e.highlight.check&&fe(n,e.check,"check"),e.selected&&(fe(n,e.selected,"selected"),e.movable.showDests)){const a=(r=e.movable.dests)===null||r===void 0?void 0:r.get(e.selected);if(a)for(const f of a)fe(n,f,"move-dest"+(e.pieces.has(f)?" oc":""));const s=e.premovable.dests;if(s)for(const f of s)fe(n,f,"premove-dest"+(e.pieces.has(f)?" oc":""))}const t=e.premovable.current;if(t)for(const a of t)fe(n,a,"current-premove");else e.predroppable.current&&fe(n,e.predroppable.current.key,"current-premove");const o=e.exploding;if(o)for(const a of o.keys)fe(n,a,"exploding"+o.stage);return n}function fe(e,r,n){const t=e.get(r);t?e.set(r,`${t} ${n}`):e.set(r,n)}function Ge(e,r,n){const t=e.get(r);t?t.push(n):e.set(r,[n])}function Tt(e,r){const t=e.drawable.autoShapes.filter(o=>o.piece).map(o=>({shape:o,hash:xt(o),current:!1}));er(t,r,o=>Rt(e,o,e.dom.bounds()))}function Mt(e){var r;const n=z(e),t=Oe(e.dom.bounds());let o=(r=e.dom.elements.autoPieces)===null||r===void 0?void 0:r.firstChild;for(;o;)Dr(o,t(N(o.cgKey),n),o.cgScale),o=o.nextSibling}function Rt(e,{shape:r,hash:n},t){var o,a,s;const f=r.orig,v=(o=r.piece)===null||o===void 0?void 0:o.role,p=(a=r.piece)===null||a===void 0?void 0:a.color,b=(s=r.piece)===null||s===void 0?void 0:s.scale,g=le("piece",`${v} ${p}`);return g.setAttribute("cgHash",n),g.cgKey=f,g.cgScale=b,Dr(g,Oe(t)(N(f),z(e)),b),g}function xt(e){var r,n,t;return[e.orig,(r=e.piece)===null||r===void 0?void 0:r.role,(n=e.piece)===null||n===void 0?void 0:n.color,(t=e.piece)===null||t===void 0?void 0:t.scale].join(",")}function It(e,r){const n=lt();Jr(n,r||{});function t(){const o="dom"in n?n.dom.unbind:void 0,a=yt(e,n),s=Sn(()=>a.board.getBoundingClientRect()),f=b=>{Pt(p),a.autoPieces&&Tt(p,a.autoPieces),!b&&a.svg&&ct(p,a.svg,a.customSvg)},v=()=>{kr(p),Et(p),a.autoPieces&&Mt(p)},p=n;return p.dom={elements:a,bounds:s,redraw:Nt(f),redrawNow:f,unbind:o},p.drawable.prevSvgHash="",kr(p),f(!1),St(p,v),o||(p.dom.unbind=Ct(p,v)),p.events.insert&&p.events.insert(a),p}return at(t(),t)}function Nt(e){let r=!1;return()=>{r||(r=!0,requestAnimationFrame(()=>{e(),r=!1}))}}const Lt=xr({__name:"Chessboard",props:{config:null},emits:["ready"],setup(e,{emit:r}){const{config:n}=e;let t=hn(null);function o(){let{value:a}=t;if(a){let s=a.parentElement;s.removeChild(a);let{width:f,height:v}=s.getBoundingClientRect();a.style.width=Math.min(f,v)+"px",a.style.height=Math.min(f,v)+"px",s.appendChild(a)}}return vn(()=>{if(t.value){o(),window.addEventListener("resize",o);let a=It(t.value,n);r("ready",a)}}),gn(()=>{window.removeEventListener("resize",o)}),(a,s)=>(Ir(),Nr(bn,{"explicit-height":"",flexbox:""},{nav:Ye(()=>[Lr(a.$slots,"nav",{},void 0,!0)]),default:Ye(()=>[mn("div",{ref_key:"boardEl",ref:t,class:"chessboard"},null,512)]),_:3}))}});var qt=pn(Lt,[["__scopeId","data-v-7122605e"]]);const Dt="pnbrqkPNBRQK",Ve="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",Ot=["1-0","0-1","1/2-1/2","*"],Ze={b:[16,32,17,15],w:[-16,-32,-17,-15]},Er={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Kt=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],$t=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Bt={p:0,n:1,b:2,r:3,q:4,k:5},y={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},Ut=7,Qt=6,Wt=1,Ht=0,P={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},de={w:[{square:P.a1,flag:y.QSIDE_CASTLE},{square:P.h1,flag:y.KSIDE_CASTLE}],b:[{square:P.a8,flag:y.QSIDE_CASTLE},{square:P.h8,flag:y.KSIDE_CASTLE}]},Ft=0,Ar=1;function zt(e,r){for(var n=e.from,t=e.to,o=e.piece,a=0,s=0,f=0,v=0,p=r.length;v<p;v++){var b=r[v].from,g=r[v].to,E=r[v].piece;o===E&&n!==b&&t===g&&(a++,ve(n)===ve(b)&&s++,De(n)===De(b)&&f++)}return a>0?s>0&&f>0?H(n):f>0?H(n).charAt(1):H(n).charAt(0):""}function jt(e){var r=e.charAt(0);if(r>="a"&&r<="h"){var n=e.match(/[a-h]\d.*[a-h]\d/);return n?void 0:te}return r=r.toLowerCase(),r==="o"?Te:r}function Tr(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function ve(e){return e>>4}function De(e){return e&15}function H(e){var r=De(e),n=ve(e);return"abcdefgh".substring(r,r+1)+"87654321".substring(n,n+1)}function Le(e){return e===oe?he:oe}function Gt(e){return"0123456789".indexOf(e)!==-1}function fn(e){var r=e instanceof Array?[]:{};for(var n in e)typeof n=="object"?r[n]=fn(e[n]):r[n]=e[n];return r}function Mr(e){return e.replace(/^\s+|\s+$/g,"")}const he="b",oe="w",X=-1,te="p",Rr="n",Be="b",Vt="r",Zt="q",Te="k",Yt=function(){for(var e=[],r=P.a8;r<=P.h1;r++){if(r&136){r+=7;continue}e.push(H(r))}return e}(),Xt={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},Jt=function(e){var r=new Array(128),n={w:X,b:X},t=oe,o={w:0,b:0},a=X,s=0,f=1,v=[],p={},b={};w(typeof e=="undefined"?Ve:e);function g(i){typeof i=="undefined"&&(i=!1),r=new Array(128),n={w:X,b:X},t=oe,o={w:0,b:0},a=X,s=0,f=1,v=[],i||(p={}),b={},$(q())}function E(){for(var i=[],l={},c=function(u){u in b&&(l[u]=b[u])};v.length>0;)i.push(ue());for(c(q());i.length>0;)ae(i.pop()),c(q());b=l}function L(){w(Ve)}function w(i,l){typeof l=="undefined"&&(l=!1);var c=i.split(/\s+/),u=c[0],h=0;if(!S(i).valid)return!1;g(l);for(var d=0;d<u.length;d++){var m=u.charAt(d);if(m==="/")h+=8;else if(Gt(m))h+=parseInt(m,10);else{var C=m<"a"?oe:he;Pe({type:m.toLowerCase(),color:C},H(h)),h++}}return t=c[1],c[2].indexOf("K")>-1&&(o.w|=y.KSIDE_CASTLE),c[2].indexOf("Q")>-1&&(o.w|=y.QSIDE_CASTLE),c[2].indexOf("k")>-1&&(o.b|=y.KSIDE_CASTLE),c[2].indexOf("q")>-1&&(o.b|=y.QSIDE_CASTLE),a=c[3]==="-"?X:P[c[3]],s=parseInt(c[4],10),f=parseInt(c[5],10),$(q()),!0}function S(i){var l={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"Illegal en-passant square"},c=i.split(/\s+/);if(c.length!==6)return{valid:!1,error_number:1,error:l[1]};if(isNaN(parseInt(c[5]))||parseInt(c[5],10)<=0)return{valid:!1,error_number:2,error:l[2]};if(isNaN(parseInt(c[4]))||parseInt(c[4],10)<0)return{valid:!1,error_number:3,error:l[3]};if(!/^(-|[abcdefgh][36])$/.test(c[3]))return{valid:!1,error_number:4,error:l[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(c[2]))return{valid:!1,error_number:5,error:l[5]};if(!/^(w|b)$/.test(c[1]))return{valid:!1,error_number:6,error:l[6]};var u=c[0].split("/");if(u.length!==8)return{valid:!1,error_number:7,error:l[7]};for(var h=0;h<u.length;h++){for(var d=0,m=!1,C=0;C<u[h].length;C++)if(isNaN(u[h][C])){if(!/^[prnbqkPRNBQK]$/.test(u[h][C]))return{valid:!1,error_number:9,error:l[9]};d+=1,m=!1}else{if(m)return{valid:!1,error_number:8,error:l[8]};d+=parseInt(u[h][C],10),m=!0}if(d!==8)return{valid:!1,error_number:10,error:l[10]}}return c[3][1]=="3"&&c[1]=="w"||c[3][1]=="6"&&c[1]=="b"?{valid:!1,error_number:11,error:l[11]}:{valid:!0,error_number:0,error:l[0]}}function q(){for(var i=0,l="",c=P.a8;c<=P.h1;c++){if(r[c]==null)i++;else{i>0&&(l+=i,i=0);var u=r[c].color,h=r[c].type;l+=u===oe?h.toUpperCase():h.toLowerCase()}c+1&136&&(i>0&&(l+=i),c!==P.h1&&(l+="/"),i=0,c+=8)}var d="";o[oe]&y.KSIDE_CASTLE&&(d+="K"),o[oe]&y.QSIDE_CASTLE&&(d+="Q"),o[he]&y.KSIDE_CASTLE&&(d+="k"),o[he]&y.QSIDE_CASTLE&&(d+="q"),d=d||"-";var m=a===X?"-":H(a);return[l,t,d,m,s,f].join(" ")}function ee(i){for(var l=0;l<i.length;l+=2)typeof i[l]=="string"&&typeof i[l+1]=="string"&&(p[i[l]]=i[l+1]);return p}function $(i){v.length>0||(i!==Ve?(p.SetUp="1",p.FEN=i):(delete p.SetUp,delete p.FEN))}function ce(i){var l=r[P[i]];return l?{type:l.type,color:l.color}:null}function Pe(i,l){if(!("type"in i&&"color"in i)||Dt.indexOf(i.type.toLowerCase())===-1||!(l in P))return!1;var c=P[l];return i.type==Te&&!(n[i.color]==X||n[i.color]==c)?!1:(r[c]={type:i.type,color:i.color},i.type===Te&&(n[i.color]=c),$(q()),!0)}function G(i){var l=ce(i);return r[P[i]]=null,l&&l.type===Te&&(n[l.color]=X),$(q()),l}function Ee(i,l,c,u,h){var d={color:t,from:l,to:c,flags:u,piece:i[l].type};return h&&(d.flags|=y.PROMOTION,d.promotion=h),i[c]?d.captured=i[c].type:u&y.EP_CAPTURE&&(d.captured=te),d}function B(i){function l(ne,Me,x,Q,Ae){if(ne[x].type===te&&(ve(Q)===Ht||ve(Q)===Ut))for(var Re=[Zt,Vt,Be,Rr],ye=0,xe=Re.length;ye<xe;ye++)Me.push(Ee(ne,x,Q,Ae,Re[ye]));else Me.push(Ee(ne,x,Q,Ae))}var c=[],u=t,h=Le(u),d={b:Wt,w:Qt},m=P.a8,C=P.h1,A=!1,I=typeof i!="undefined"&&"legal"in i?i.legal:!0,O=typeof i!="undefined"&&"piece"in i&&typeof i.piece=="string"?i.piece.toLowerCase():!0;if(typeof i!="undefined"&&"square"in i)if(i.square in P)m=C=P[i.square],A=!0;else return[];for(var _=m;_<=C;_++){if(_&136){_+=7;continue}var M=r[_];if(!(M==null||M.color!==u)){if(M.type===te&&(O===!0||O===te)){var k=_+Ze[u][0];if(r[k]==null){l(r,c,_,k,y.NORMAL);var k=_+Ze[u][1];d[u]===ve(_)&&r[k]==null&&l(r,c,_,k,y.BIG_PAWN)}for(R=2;R<4;R++){var k=_+Ze[u][R];k&136||(r[k]!=null&&r[k].color===h?l(r,c,_,k,y.CAPTURE):k===a&&l(r,c,_,a,y.EP_CAPTURE))}}else if(O===!0||O===M.type)for(var R=0,D=Er[M.type].length;R<D;R++)for(var Y=Er[M.type][R],k=_;k+=Y,!(k&136);){if(r[k]==null)l(r,c,_,k,y.NORMAL);else{if(r[k].color===u)break;l(r,c,_,k,y.CAPTURE);break}if(M.type==="n"||M.type==="k")break}}}if((O===!0||O===Te)&&(!A||C===n[u])){if(o[u]&y.KSIDE_CASTLE){var K=n[u],re=K+2;r[K+1]==null&&r[re]==null&&!j(h,n[u])&&!j(h,K+1)&&!j(h,re)&&l(r,c,n[u],re,y.KSIDE_CASTLE)}if(o[u]&y.QSIDE_CASTLE){var K=n[u],re=K-2;r[K-1]==null&&r[K-2]==null&&r[K-3]==null&&!j(h,n[u])&&!j(h,K-1)&&!j(h,re)&&l(r,c,n[u],re,y.QSIDE_CASTLE)}}if(!I)return c;for(var we=[],_=0,D=c.length;_<D;_++)ae(c[_]),W(u)||we.push(c[_]),ue();return we}function T(i,l){var c="";if(i.flags&y.KSIDE_CASTLE)c="O-O";else if(i.flags&y.QSIDE_CASTLE)c="O-O-O";else{if(i.piece!==te){var u=zt(i,l);c+=i.piece.toUpperCase()+u}i.flags&(y.CAPTURE|y.EP_CAPTURE)&&(i.piece===te&&(c+=H(i.from)[0]),c+="x"),c+=H(i.to),i.flags&y.PROMOTION&&(c+="="+i.promotion.toUpperCase())}return ae(i),U()&&(se()?c+="#":c+="+"),ue(),c}function j(i,l){for(var c=P.a8;c<=P.h1;c++){if(c&136){c+=7;continue}if(!(r[c]==null||r[c].color!==i)){var u=r[c],h=c-l,d=h+119;if(Kt[d]&1<<Bt[u.type]){if(u.type===te){if(h>0){if(u.color===oe)return!0}else if(u.color===he)return!0;continue}if(u.type==="n"||u.type==="k")return!0;for(var m=$t[d],C=c+m,A=!1;C!==l;){if(r[C]!=null){A=!0;break}C+=m}if(!A)return!0}}}return!1}function W(i){return j(Le(i),n[i])}function U(){return W(t)}function se(){return U()&&B().length===0}function We(){return!U()&&B().length===0}function He(){for(var i={},l=[],c=0,u=0,h=P.a8;h<=P.h1;h++){if(u=(u+1)%2,h&136){h+=7;continue}var d=r[h];d&&(i[d.type]=d.type in i?i[d.type]+1:1,d.type===Be&&l.push(u),c++)}if(c===2)return!0;if(c===3&&(i[Be]===1||i[Rr]===1))return!0;if(c===i[Be]+2){for(var m=0,C=l.length,h=0;h<C;h++)m+=l[h];if(m===0||m===C)return!0}return!1}function Fe(){for(var i=[],l={},c=!1;;){var u=ue();if(!u)break;i.push(u)}for(;;){var h=q().split(" ").slice(0,4).join(" ");if(l[h]=h in l?l[h]+1:1,l[h]>=3&&(c=!0),!i.length)break;ae(i.pop())}return c}function dn(i){v.push({move:i,kings:{b:n.b,w:n.w},turn:t,castling:{b:o.b,w:o.w},ep_square:a,half_moves:s,move_number:f})}function ae(i){var l=t,c=Le(l);if(dn(i),r[i.to]=r[i.from],r[i.from]=null,i.flags&y.EP_CAPTURE&&(t===he?r[i.to-16]=null:r[i.to+16]=null),i.flags&y.PROMOTION&&(r[i.to]={type:i.promotion,color:l}),r[i.to].type===Te){if(n[r[i.to].color]=i.to,i.flags&y.KSIDE_CASTLE){var u=i.to-1,h=i.to+1;r[u]=r[h],r[h]=null}else if(i.flags&y.QSIDE_CASTLE){var u=i.to+1,h=i.to-2;r[u]=r[h],r[h]=null}o[l]=""}if(o[l]){for(var d=0,m=de[l].length;d<m;d++)if(i.from===de[l][d].square&&o[l]&de[l][d].flag){o[l]^=de[l][d].flag;break}}if(o[c]){for(var d=0,m=de[c].length;d<m;d++)if(i.to===de[c][d].square&&o[c]&de[c][d].flag){o[c]^=de[c][d].flag;break}}i.flags&y.BIG_PAWN?t==="b"?a=i.to-16:a=i.to+16:a=X,i.piece===te||i.flags&(y.CAPTURE|y.EP_CAPTURE)?s=0:s++,t===he&&f++,t=Le(t)}function ue(){var i=v.pop();if(i==null)return null;var l=i.move;n=i.kings,t=i.turn,o=i.castling,a=i.ep_square,s=i.half_moves,f=i.move_number;var c=t,u=Le(t);if(r[l.from]=r[l.to],r[l.from].type=l.piece,r[l.to]=null,l.flags&y.CAPTURE)r[l.to]={type:l.captured,color:u};else if(l.flags&y.EP_CAPTURE){var h;c===he?h=l.to-16:h=l.to+16,r[h]={type:te,color:u}}if(l.flags&(y.KSIDE_CASTLE|y.QSIDE_CASTLE)){var d,m;l.flags&y.KSIDE_CASTLE?(d=l.to+1,m=l.to-1):l.flags&y.QSIDE_CASTLE&&(d=l.to-2,m=l.to+1),r[d]=r[m],r[m]=null}return l}function dr(i,l){for(var c=Tr(i),u=0;u<2;u++){if(u==Ar){if(!l)return null;var h=!1,d=c.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(d){var m=d[1],C=d[2],A=d[3],I=d[4];C.length==1&&(h=!0)}else{var d=c.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/);if(d){var m=d[1],C=d[2],A=d[3],I=d[4];if(C.length==1)var h=!0}}}for(var O=jt(c),_=B({legal:!0,piece:m||O}),M=0,k=_.length;M<k;M++)switch(u){case Ft:{if(c===Tr(T(_[M],_)))return _[M];break}case Ar:if(d){if((!m||m.toLowerCase()==_[M].piece)&&P[C]==_[M].from&&P[A]==_[M].to&&(!I||I.toLowerCase()==_[M].promotion))return _[M];if(h){var R=H(_[M].from);if((!m||m.toLowerCase()==_[M].piece)&&P[A]==_[M].to&&(C==R[0]||C==R[1])&&(!I||I.toLowerCase()==_[M].promotion))return _[M]}}}}return null}function Ke(i){var l=fn(i);l.san=T(l,B({legal:!0})),l.to=H(l.to),l.from=H(l.from);var c="";for(var u in y)y[u]&l.flags&&(c+=Xt[u]);return l.flags=c,l}function pr(i){for(var l=B({legal:!1}),c=0,u=t,h=0,d=l.length;h<d;h++){if(ae(l[h]),!W(u))if(i-1>0){var m=pr(i-1);c+=m}else c++;ue()}return c}return{load:function(i){return w(i)},reset:function(){return L()},moves:function(i){for(var l=B(i),c=[],u=0,h=l.length;u<h;u++)typeof i!="undefined"&&"verbose"in i&&i.verbose?c.push(Ke(l[u])):c.push(T(l[u],B({legal:!0})));return c},in_check:function(){return U()},in_checkmate:function(){return se()},in_stalemate:function(){return We()},in_draw:function(){return s>=100||We()||He()||Fe()},insufficient_material:function(){return He()},in_threefold_repetition:function(){return Fe()},game_over:function(){return s>=100||se()||We()||He()||Fe()},validate_fen:function(i){return S(i)},fen:function(){return q()},board:function(){for(var i=[],l=[],c=P.a8;c<=P.h1;c++)r[c]==null?l.push(null):l.push({square:H(c),type:r[c].type,color:r[c].color}),c+1&136&&(i.push(l),l=[],c+=8);return i},pgn:function(i){var l=typeof i=="object"&&typeof i.newline_char=="string"?i.newline_char:`
`,c=typeof i=="object"&&typeof i.max_width=="number"?i.max_width:0,u=[],h=!1;for(var d in p)u.push("["+d+' "'+p[d]+'"]'+l),h=!0;h&&v.length&&u.push(l);for(var m=function(R){var D=b[q()];if(typeof D!="undefined"){var Y=R.length>0?" ":"";R=`${R}${Y}{${D}}`}return R},C=[];v.length>0;)C.push(ue());var A=[],I="";for(C.length===0&&A.push(m(""));C.length>0;){I=m(I);var O=C.pop();!v.length&&O.color==="b"?I=f+". ...":O.color==="w"&&(I.length&&A.push(I),I=f+"."),I=I+" "+T(O,B({legal:!0})),ae(O)}if(I.length&&A.push(m(I)),typeof p.Result!="undefined"&&A.push(p.Result),c===0)return u.join("")+A.join(" ");for(var _=function(){return u.length>0&&u[u.length-1]===" "?(u.pop(),!0):!1},M=function(R,D){for(var Y of D.split(" "))if(!!Y){if(R+Y.length>c){for(;_();)R--;u.push(l),R=0}u.push(Y),R+=Y.length,u.push(" "),R++}return _()&&R--,R},k=0,d=0;d<A.length;d++){if(k+A[d].length>c&&A[d].includes("{")){k=M(k,A[d]);continue}k+A[d].length>c&&d!==0?(u[u.length-1]===" "&&u.pop(),u.push(l),k=0):d!==0&&(u.push(" "),k++),u.push(A[d]),k+=A[d].length}return u.join("")},load_pgn:function(i,l){var c=typeof l!="undefined"&&"sloppy"in l?l.sloppy:!1;function u(x){return x.replace(/\\/g,"\\")}function h(x,Q){for(var Ae=typeof Q=="object"&&typeof Q.newline_char=="string"?Q.newline_char:`\r?
`,Re={},ye=x.split(new RegExp(u(Ae))),xe="",hr="",$e=0;$e<ye.length;$e++){var vr=/^\s*\[([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;xe=ye[$e].replace(vr,"$1"),hr=ye[$e].replace(vr,"$2"),Mr(xe).length>0&&(Re[xe]=hr)}return Re}i=i.trim();var d=typeof l=="object"&&typeof l.newline_char=="string"?l.newline_char:`\r?
`,m=new RegExp("^(\\[((?:"+u(d)+")|.)*\\])(?:\\s*"+u(d)+"){2}"),C=m.test(i)?m.exec(i)[1]:"";L();var A=h(C,l),I="";for(var O in A)O.toLowerCase()==="fen"&&(I=A[O]),ee([O,A[O]]);if(c){if(I&&!w(I,!0))return!1}else if(A.SetUp==="1"&&!("FEN"in A&&w(A.FEN,!0)))return!1;for(var _=function(x){return Array.from(x).map(function(Q){return Q.charCodeAt(0)<128?Q.charCodeAt(0).toString(16):encodeURIComponent(Q).replace(/\%/g,"").toLowerCase()}).join("")},M=function(x){return x.length==0?"":decodeURIComponent("%"+x.match(/.{1,2}/g).join("%"))},k=function(x){return x=x.replace(new RegExp(u(d),"g")," "),`{${_(x.slice(1,x.length-1))}}`},R=function(x){if(x.startsWith("{")&&x.endsWith("}"))return M(x.slice(1,x.length-1))},D=i.replace(C,"").replace(new RegExp(`({[^}]*})+?|;([^${u(d)}]*)`,"g"),function(x,Q,Ae){return Q!==void 0?k(Q):" "+k(`{${Ae.slice(1)}}`)}).replace(new RegExp(u(d),"g")," "),Y=/(\([^\(\)]+\))+?/g;Y.test(D);)D=D.replace(Y,"");D=D.replace(/\d+\.(\.\.)?/g,""),D=D.replace(/\.\.\./g,""),D=D.replace(/\$\d+/g,"");var K=Mr(D).split(new RegExp(/\s+/));K=K.join(",").replace(/,,+/g,",").split(",");for(var re="",we="",ne=0;ne<K.length;ne++){var Me=R(K[ne]);if(Me!==void 0){b[q()]=Me;continue}if(re=dr(K[ne],c),re==null)if(Ot.indexOf(K[ne])>-1)we=K[ne];else return!1;else we="",ae(re)}return we&&Object.keys(p).length&&!p.Result&&ee(["Result",we]),!0},header:function(){return ee(arguments)},turn:function(){return t},move:function(i,l){var c=typeof l!="undefined"&&"sloppy"in l?l.sloppy:!1,u=null;if(typeof i=="string")u=dr(i,c);else if(typeof i=="object"){for(var h=B(),d=0,m=h.length;d<m;d++)if(i.from===H(h[d].from)&&i.to===H(h[d].to)&&(!("promotion"in h[d])||i.promotion===h[d].promotion)){u=h[d];break}}if(!u)return null;var C=Ke(u);return ae(u),C},undo:function(){var i=ue();return i?Ke(i):null},clear:function(){return g()},put:function(i,l){return Pe(i,l)},get:function(i){return ce(i)},ascii(){for(var i=`   +------------------------+
`,l=P.a8;l<=P.h1;l++){if(De(l)===0&&(i+=" "+"87654321"[ve(l)]+" |"),r[l]==null)i+=" . ";else{var c=r[l].type,u=r[l].color,h=u===oe?c.toUpperCase():c.toLowerCase();i+=" "+h+" "}l+1&136&&(i+=`|
`,l+=8)}return i+=`   +------------------------+
`,i+="     a  b  c  d  e  f  g  h",i},remove:function(i){return G(i)},perft:function(i){return pr(i)},square_color:function(i){if(i in P){var l=P[i];return(ve(l)+De(l))%2===0?"light":"dark"}return null},history:function(i){for(var l=[],c=[],u=typeof i!="undefined"&&("verbose"in i)&&i.verbose;v.length>0;)l.push(ue());for(;l.length>0;){var h=l.pop();u?c.push(Ke(h)):c.push(T(h,B({legal:!0}))),ae(h)}return c},get_comment:function(){return b[q()]},set_comment:function(i){b[q()]=i.replace("{","[").replace("}","]")},delete_comment:function(){var i=b[q()];return delete b[q()],i},get_comments:function(){return E(),Object.keys(b).map(function(i){return{fen:i,comment:b[i]}})},delete_comments:function(){return E(),Object.keys(b).map(function(i){var l=b[i];return delete b[i],{fen:i,comment:l}})}}},ro=xr({__name:"LegalMoveChessboard",props:{position:null,orientation:null,destinations:null},emits:["ready","move"],setup(e,{emit:r}){const{position:n,orientation:t="white",destinations:o}=e;async function a(g,E){if(g=="a0"||E=="a0"||!s)return;if(o){let S=s.state.pieces.get(g);S&&(s.state.pieces.delete(g),s.state.pieces.set(E,S)),f.load(`${s.getFen()} ${f.turn()=="w"?"b":"w"} - - 0 1`)}else f.move({from:g,to:E,promotion:"q"},{sloppy:!0});s.set({turnColor:f.turn()==="w"?"white":"black",fen:f.fen(),check:f.in_check(),lastMove:[g,E],movable:{color:f.turn()==="w"?"white":"black",dests:new Map}});let L;r("move",S=>L=S,f,s);let w=await L;w?setTimeout(()=>a(w.from,w.to)):s.set({movable:{dests:p()}})}let s,f=Jt(n),v={fen:f.fen().split(" ")[0],orientation:t,premovable:{enabled:!1},turnColor:f.turn()==="w"?"white":"black",movable:{free:!1,color:f.turn()==="w"?"white":"black",dests:new Map,events:{after:a}}};function p(){if(o)return o(f);let g=new Map;for(let E of Yt){let L=f.moves({square:E,verbose:!0});L.length&&g.set(E,L.map(({to:w})=>w))}return g}async function b(g){s=g,r("ready",s,f);let E;r("move",w=>E=w,f,s);let L=await E;L?setTimeout(()=>a(L.from,L.to)):s.set({turnColor:f.turn()==="w"?"white":"black",check:f.in_check(),movable:{color:f.turn()==="w"?"white":"black",dests:p()}})}return(g,E)=>(Ir(),Nr(qt,{config:wn(v),onReady:b},{nav:Ye(()=>[Lr(g.$slots,"nav")]),_:3},8,["config"]))}});export{Yt as S,ro as _};
