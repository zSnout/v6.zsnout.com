import{_ as gn,d as Cr,r as pn,m as In,y as Mn,o as Pr,e as Er,w as Fe,g as kr,b as mn,D as hn,u as vn}from"./index.075875a4.js";const Sn=["white","black"],rr=["a","b","c","d","e","f","g","h"],nr=["1","2","3","4","5","6","7","8"],bn=[...nr].reverse(),ir=Array.prototype.concat(...rr.map(e=>nr.map(r=>e+r))),q=e=>ir[8*e[0]+e[1]],E=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],zr=ir.map(E);function wn(e){let r;const n=()=>(r===void 0&&(r=e()),r);return n.clear=()=>{r=void 0},n}const yn=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const r=performance.now()-e;return e=void 0,r}}},tr=e=>e==="white"?"black":"white",ze=(e,r)=>{const n=e[0]-r[0],i=e[1]-r[1];return n*n+i*i},Xe=(e,r)=>e.role===r.role&&e.color===r.color,Ue=e=>(r,n)=>[(n?r[0]:7-r[0])*e.width/8,(n?7-r[1]:r[1])*e.height/8],oe=(e,r)=>{e.style.transform=`translate(${r[0]}px,${r[1]}px)`},Zr=(e,r,n=1)=>{e.style.transform=`translate(${r[0]}px,${r[1]}px) scale(${n})`},or=(e,r)=>{e.style.visibility=r?"visible":"hidden"},ye=e=>{var r;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((r=e.targetTouches)===null||r===void 0)&&r[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},Ur=e=>e.buttons===2||e.button===2,ce=(e,r)=>{const n=document.createElement(e);return r&&(n.className=r),n};function Hr(e,r,n){const i=E(e);return r||(i[0]=7-i[0],i[1]=7-i[1]),[n.left+n.width*i[0]/8+n.width/16,n.top+n.height*(7-i[1])/8+n.height/16]}function we(e,r){return Math.abs(e-r)}function Ln(e){return(r,n,i,t)=>we(r,i)<2&&(e==="white"?t===n+1||n<=1&&t===n+2&&r===i:t===n-1||n>=6&&t===n-2&&r===i)}const Rr=(e,r,n,i)=>{const t=we(e,n),a=we(r,i);return t===1&&a===2||t===2&&a===1},_r=(e,r,n,i)=>we(e,n)===we(r,i),Wr=(e,r,n,i)=>e===n||r===i,Br=(e,r,n,i)=>_r(e,r,n,i)||Wr(e,r,n,i);function Nn(e,r,n){return(i,t,a,u)=>we(i,a)<2&&we(t,u)<2||n&&t===u&&t===(e==="white"?0:7)&&(i===4&&(a===2&&r.includes(0)||a===6&&r.includes(7))||r.includes(a))}function An(e,r){const n=r==="white"?"1":"8",i=[];for(const[t,a]of e)t[1]===n&&a.color===r&&a.role==="rook"&&i.push(E(t)[0]);return i}function Gr(e,r,n){const i=e.get(r);if(!i)return[];const t=E(r),a=i.role,u=a==="pawn"?Ln(i.color):a==="knight"?Rr:a==="bishop"?_r:a==="rook"?Wr:a==="queen"?Br:Nn(i.color,An(e,i.color),n);return zr.filter(d=>(t[0]!==d[0]||t[1]!==d[1])&&u(t[0],t[1],d[0],d[1])).map(q)}function O(e,...r){e&&setTimeout(()=>e(...r),1)}function Dn(e){e.orientation=tr(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function jn(e,r){for(const[n,i]of r)i?e.pieces.set(n,i):e.pieces.delete(n)}function Tn(e,r){if(e.check=void 0,r===!0&&(r=e.turnColor),r)for(const[n,i]of e.pieces)i.role==="king"&&i.color===r&&(e.check=n)}function xn(e,r,n,i){he(e),e.premovable.current=[r,n],O(e.premovable.events.set,r,n,i)}function me(e){e.premovable.current&&(e.premovable.current=void 0,O(e.premovable.events.unset))}function Cn(e,r,n){me(e),e.predroppable.current={role:r,key:n},O(e.predroppable.events.set,r,n)}function he(e){const r=e.predroppable;r.current&&(r.current=void 0,O(r.events.unset))}function Pn(e,r,n){if(!e.autoCastle)return!1;const i=e.pieces.get(r);if(!i||i.role!=="king")return!1;const t=E(r),a=E(n);if(t[1]!==0&&t[1]!==7||t[1]!==a[1])return!1;t[0]===4&&!e.pieces.has(n)&&(a[0]===6?n=q([7,a[1]]):a[0]===2&&(n=q([0,a[1]])));const u=e.pieces.get(n);return!u||u.color!==i.color||u.role!=="rook"?!1:(e.pieces.delete(r),e.pieces.delete(n),t[0]<a[0]?(e.pieces.set(q([6,a[1]]),i),e.pieces.set(q([5,a[1]]),u)):(e.pieces.set(q([2,a[1]]),i),e.pieces.set(q([3,a[1]]),u)),!0)}function Qr(e,r,n){const i=e.pieces.get(r),t=e.pieces.get(n);if(r===n||!i)return!1;const a=t&&t.color!==i.color?t:void 0;return n===e.selected&&K(e),O(e.events.move,r,n,a),Pn(e,r,n)||(e.pieces.set(n,i),e.pieces.delete(r)),e.lastMove=[r,n],e.check=void 0,O(e.events.change),a||!0}function ar(e,r,n,i){if(e.pieces.has(n))if(i)e.pieces.delete(n);else return!1;return O(e.events.dropNewPiece,r,n),e.pieces.set(n,r),e.lastMove=[n],e.check=void 0,O(e.events.change),e.movable.dests=void 0,e.turnColor=tr(e.turnColor),!0}function Or(e,r,n){const i=Qr(e,r,n);return i&&(e.movable.dests=void 0,e.turnColor=tr(e.turnColor),e.animation.current=void 0),i}function Yr(e,r,n){if(cr(e,r,n)){const i=Or(e,r,n);if(i){const t=e.hold.stop();K(e);const a={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:t};return i!==!0&&(a.captured=i),O(e.movable.events.after,r,n,a),!0}}else if(kn(e,r,n))return xn(e,r,n,{ctrlKey:e.stats.ctrlKey}),K(e),!0;return K(e),!1}function Vr(e,r,n,i){const t=e.pieces.get(r);t&&(En(e,r,n)||i)?(e.pieces.delete(r),ar(e,t,n,i),O(e.movable.events.afterNewPiece,t.role,n,{premove:!1,predrop:!1})):t&&zn(e,r,n)?Cn(e,t.role,n):(me(e),he(e)),e.pieces.delete(r),K(e)}function $e(e,r,n){if(O(e.events.select,r),e.selected){if(e.selected===r&&!e.draggable.enabled){K(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==r&&Yr(e,e.selected,r)){e.stats.dragged=!1;return}}(qr(e,r)||lr(e,r))&&(Jr(e,r),e.hold.start())}function Jr(e,r){e.selected=r,lr(e,r)?e.premovable.dests=Gr(e.pieces,r,e.premovable.castle):e.premovable.dests=void 0}function K(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function qr(e,r){const n=e.pieces.get(r);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}function cr(e,r,n){var i,t;return r!==n&&qr(e,r)&&(e.movable.free||!!(!((t=(i=e.movable.dests)===null||i===void 0?void 0:i.get(r))===null||t===void 0)&&t.includes(n)))}function En(e,r,n){const i=e.pieces.get(r);return!!i&&(r===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===i.color&&e.turnColor===i.color)}function lr(e,r){const n=e.pieces.get(r);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function kn(e,r,n){return r!==n&&lr(e,r)&&Gr(e.pieces,r,e.premovable.castle).includes(n)}function zn(e,r,n){const i=e.pieces.get(r),t=e.pieces.get(n);return!!i&&(!t||t.color!==e.movable.color)&&e.predroppable.enabled&&(i.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===i.color&&e.turnColor!==i.color}function Zn(e,r){const n=e.pieces.get(r);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function Un(e){const r=e.premovable.current;if(!r)return!1;const n=r[0],i=r[1];let t=!1;if(cr(e,n,i)){const a=Or(e,n,i);if(a){const u={premove:!0};a!==!0&&(u.captured=a),O(e.movable.events.after,n,i,u),t=!0}}return me(e),t}function Hn(e,r){const n=e.predroppable.current;let i=!1;if(!n)return!1;if(r(n)){const t={role:n.role,color:e.movable.color};ar(e,t,n.key)&&(O(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),i=!0)}return he(e),i}function ur(e){me(e),he(e),K(e)}function Mr(e){e.movable.color=e.movable.dests=e.animation.current=void 0,ur(e)}function Le(e,r,n){let i=Math.floor(8*(e[0]-n.left)/n.width);r||(i=7-i);let t=7-Math.floor(8*(e[1]-n.top)/n.height);return r||(t=7-t),i>=0&&i<8&&t>=0&&t<8?q([i,t]):void 0}function Rn(e,r,n,i){const t=E(e),a=zr.filter(g=>Br(t[0],t[1],g[0],g[1])||Rr(t[0],t[1],g[0],g[1])),d=a.map(g=>Hr(q(g),n,i)).map(g=>ze(r,g)),[,I]=d.reduce((g,h,M)=>g[0]<h?g:[h,M],[d[0],0]);return q(a[I])}function Y(e){return e.orientation==="white"}const Kr="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",_n={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Wn={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function Fr(e){e==="start"&&(e=Kr);const r=new Map;let n=7,i=0;for(const t of e)switch(t){case" ":case"[":return r;case"/":if(--n,n<0)return r;i=0;break;case"~":{const a=r.get(q([i-1,n]));a&&(a.promoted=!0);break}default:{const a=t.charCodeAt(0);if(a<57)i+=a-48;else{const u=t.toLowerCase();r.set(q([i,n]),{role:_n[u],color:t===u?"black":"white"}),++i}}}return r}function Bn(e){return bn.map(r=>rr.map(n=>{const i=e.get(n+r);if(i){let t=Wn[i.role];return i.color==="white"&&(t=t.toUpperCase()),i.promoted&&(t+="~"),t}else return"1"}).join("")).join("/").replace(/1{2,}/g,r=>r.length.toString())}function Xr(e,r){r.animation&&(sr(e.animation,r.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function $r(e,r){var n,i;if(!((n=r.movable)===null||n===void 0)&&n.dests&&(e.movable.dests=void 0),!((i=r.drawable)===null||i===void 0)&&i.autoShapes&&(e.drawable.autoShapes=[]),sr(e,r),r.fen&&(e.pieces=Fr(r.fen),e.drawable.shapes=[]),"check"in r&&Tn(e,r.check||!1),"lastMove"in r&&!r.lastMove?e.lastMove=void 0:r.lastMove&&(e.lastMove=r.lastMove),e.selected&&Jr(e,e.selected),Xr(e,r),!e.movable.rookCastle&&e.movable.dests){const t=e.movable.color==="white"?"1":"8",a="e"+t,u=e.movable.dests.get(a),d=e.pieces.get(a);if(!u||!d||d.role!=="king")return;e.movable.dests.set(a,u.filter(I=>!(I==="a"+t&&u.includes("c"+t))&&!(I==="h"+t&&u.includes("g"+t))))}}function sr(e,r){for(const n in r)mr(e[n])&&mr(r[n])?sr(e[n],r[n]):e[n]=r[n]}function mr(e){return typeof e=="object"}function be(e,r){return r.animation.enabled?On(e,r):ge(e,r)}function ge(e,r){const n=e(r);return r.dom.redraw(),n}function Ye(e,r){return{key:e,pos:E(e),piece:r}}function Gn(e,r){return r.sort((n,i)=>ze(e.pos,n.pos)-ze(e.pos,i.pos))[0]}function Qn(e,r){const n=new Map,i=[],t=new Map,a=[],u=[],d=new Map;let I,g,h;for(const[M,A]of e)d.set(M,Ye(M,A));for(const M of ir)I=r.pieces.get(M),g=d.get(M),I?g?Xe(I,g.piece)||(a.push(g),u.push(Ye(M,I))):u.push(Ye(M,I)):g&&a.push(g);for(const M of u)g=Gn(M,a.filter(A=>Xe(M.piece,A.piece))),g&&(h=[g.pos[0]-M.pos[0],g.pos[1]-M.pos[1]],n.set(M.key,h.concat(h)),i.push(g.key));for(const M of a)i.includes(M.key)||t.set(M.key,M.piece);return{anims:n,fadings:t}}function en(e,r){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const i=1-(r-n.start)*n.frequency;if(i<=0)e.animation.current=void 0,e.dom.redrawNow();else{const t=Yn(i);for(const a of n.plan.anims.values())a[2]=a[0]*t,a[3]=a[1]*t;e.dom.redrawNow(!0),requestAnimationFrame((a=performance.now())=>en(e,a))}}function On(e,r){const n=new Map(r.pieces),i=e(r),t=Qn(n,r);if(t.anims.size||t.fadings.size){const a=r.animation.current&&r.animation.current.start;r.animation.current={start:performance.now(),frequency:1/r.animation.duration,plan:t},a||en(r,performance.now())}else r.dom.redraw();return i}function Yn(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}const Vn=["green","red","blue","yellow"];function Jn(e,r){if(r.touches&&r.touches.length>1)return;r.stopPropagation(),r.preventDefault(),r.ctrlKey?K(e):ur(e);const n=ye(r),i=Le(n,Y(e),e.dom.bounds());!i||(e.drawable.current={orig:i,pos:n,brush:Xn(r),snapToValidMove:e.drawable.defaultSnapToValidMove},rn(e))}function rn(e){requestAnimationFrame(()=>{const r=e.drawable.current;if(r){const n=Le(r.pos,Y(e),e.dom.bounds());n||(r.snapToValidMove=!1);const i=r.snapToValidMove?Rn(r.orig,r.pos,Y(e),e.dom.bounds()):n;i!==r.mouseSq&&(r.mouseSq=i,r.dest=i!==r.orig?i:void 0,e.dom.redrawNow()),rn(e)}})}function qn(e,r){e.drawable.current&&(e.drawable.current.pos=ye(r))}function Kn(e){const r=e.drawable.current;r&&(r.mouseSq&&$n(e.drawable,r),nn(e))}function nn(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Fn(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),tn(e.drawable))}function Xn(e){var r;const n=(e.shiftKey||e.ctrlKey)&&Ur(e),i=e.altKey||e.metaKey||((r=e.getModifierState)===null||r===void 0?void 0:r.call(e,"AltGraph"));return Vn[(n?1:0)+(i?2:0)]}function $n(e,r){const n=t=>t.orig===r.orig&&t.dest===r.dest,i=e.shapes.find(n);i&&(e.shapes=e.shapes.filter(t=>!n(t))),(!i||i.brush!==r.brush)&&e.shapes.push(r),tn(e)}function tn(e){e.onChange&&e.onChange(e.shapes)}function ei(e,r){if(!r.isTrusted||r.button!==void 0&&r.button!==0||r.touches&&r.touches.length>1)return;const n=e.dom.bounds(),i=ye(r),t=Le(i,Y(e),n);if(!t)return;const a=e.pieces.get(t),u=e.selected;!u&&e.drawable.enabled&&(e.drawable.eraseOnClick||!a||a.color!==e.turnColor)&&Fn(e),r.cancelable!==!1&&(!r.touches||e.blockTouchScroll||a||u||ri(e,i))&&r.preventDefault();const d=!!e.premovable.current,I=!!e.predroppable.current;e.stats.ctrlKey=r.ctrlKey,e.selected&&cr(e,e.selected,t)?be(M=>$e(M,t),e):$e(e,t);const g=e.selected===t,h=an(e,t);if(a&&h&&g&&Zn(e,t)){e.draggable.current={orig:t,piece:a,origPos:i,pos:i,started:e.draggable.autoDistance&&e.stats.dragged,element:h,previouslySelected:u,originTarget:r.target,keyHasChanged:!1},h.cgDragging=!0,h.classList.add("dragging");const M=e.dom.elements.ghost;M&&(M.className=`ghost ${a.color} ${a.role}`,oe(M,Ue(n)(E(t),Y(e))),or(M,!0)),dr(e)}else d&&me(e),I&&he(e);e.dom.redraw()}function ri(e,r){const n=Y(e),i=e.dom.bounds(),t=Math.pow(i.width/8,2);for(const a of e.pieces.keys()){const u=Hr(a,n,i);if(ze(u,r)<=t)return!0}return!1}function ni(e,r,n,i){const t="a0";e.pieces.set(t,r),e.dom.redraw();const a=ye(n);e.draggable.current={orig:t,piece:r,origPos:a,pos:a,started:!0,element:()=>an(e,t),originTarget:n.target,newPiece:!0,force:!!i,keyHasChanged:!1},dr(e)}function dr(e){requestAnimationFrame(()=>{var r;const n=e.draggable.current;if(!n)return;!((r=e.animation.current)===null||r===void 0)&&r.plan.anims.has(n.orig)&&(e.animation.current=void 0);const i=e.pieces.get(n.orig);if(!i||!Xe(i,n.piece))We(e);else if(!n.started&&ze(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const a=n.element();if(!a)return;a.cgDragging=!0,a.classList.add("dragging"),n.element=a}const t=e.dom.bounds();oe(n.element,[n.pos[0]-t.left-t.width/16,n.pos[1]-t.top-t.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==Le(n.pos,Y(e),t))}dr(e)})}function ii(e,r){e.draggable.current&&(!r.touches||r.touches.length<2)&&(e.draggable.current.pos=ye(r))}function ti(e,r){const n=e.draggable.current;if(!n)return;if(r.type==="touchend"&&r.cancelable!==!1&&r.preventDefault(),r.type==="touchend"&&n.originTarget!==r.target&&!n.newPiece){e.draggable.current=void 0;return}me(e),he(e);const i=ye(r)||n.pos,t=Le(i,Y(e),e.dom.bounds());t&&n.started&&n.orig!==t?n.newPiece?Vr(e,n.orig,t,n.force):(e.stats.ctrlKey=r.ctrlKey,Yr(e,n.orig,t)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!t&&(e.pieces.delete(n.orig),O(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===t||!t)?K(e):e.selectable.enabled||K(e),on(e),e.draggable.current=void 0,e.dom.redraw()}function We(e){const r=e.draggable.current;r&&(r.newPiece&&e.pieces.delete(r.orig),e.draggable.current=void 0,K(e),on(e),e.dom.redraw())}function on(e){const r=e.dom.elements;r.ghost&&or(r.ghost,!1)}function an(e,r){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===r&&n.tagName==="PIECE")return n;n=n.nextSibling}}function oi(e,r){e.exploding={stage:1,keys:r},e.dom.redraw(),setTimeout(()=>{hr(e,2),setTimeout(()=>hr(e,void 0),120)},120)}function hr(e,r){e.exploding&&(r?e.exploding.stage=r:e.exploding=void 0,e.dom.redraw())}function ai(e,r){function n(){Dn(e),r()}return{set(i){i.orientation&&i.orientation!==e.orientation&&n(),Xr(e,i),(i.fen?be:ge)(t=>$r(t,i),e)},state:e,getFen:()=>Bn(e.pieces),toggleOrientation:n,setPieces(i){be(t=>jn(t,i),e)},selectSquare(i,t){i?be(a=>$e(a,i,t),e):e.selected&&(K(e),e.dom.redraw())},move(i,t){be(a=>Qr(a,i,t),e)},newPiece(i,t){be(a=>ar(a,i,t),e)},playPremove(){if(e.premovable.current){if(be(Un,e))return!0;e.dom.redraw()}return!1},playPredrop(i){if(e.predroppable.current){const t=Hn(e,i);return e.dom.redraw(),t}return!1},cancelPremove(){ge(me,e)},cancelPredrop(){ge(he,e)},cancelMove(){ge(i=>{ur(i),We(i)},e)},stop(){ge(i=>{Mr(i),We(i)},e)},explode(i){oi(e,i)},setAutoShapes(i){ge(t=>t.drawable.autoShapes=i,e)},setShapes(i){ge(t=>t.drawable.shapes=i,e)},getKeyAtDomPos(i){return Le(i,Y(e),e.dom.bounds())},redrawAll:r,dragNewPiece(i,t,a){ni(e,i,t,a)},destroy(){Mr(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function ci(){return{pieces:Fr(Kr),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,addDimensionsCssVars:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:yn()}}function er(e,r,n){const i=new Map,t=[];for(const d of e)i.set(d.hash,!1);let a=r.firstChild,u;for(;a;)u=a.getAttribute("cgHash"),i.has(u)?i.set(u,!0):t.push(a),a=a.nextSibling;for(const d of t)r.removeChild(d);for(const d of e)i.get(d.hash)||r.appendChild(n(d))}function $(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function li(e,r,n){const i=e.drawable,t=i.current,a=t&&t.mouseSq?t:void 0,u=new Map,d=e.dom.bounds(),I=i.autoShapes.filter(v=>!v.piece);for(const v of i.shapes.concat(I).concat(a?[a]:[]))v.dest&&u.set(v.dest,(u.get(v.dest)||0)+1);const g=i.shapes.concat(I).map(v=>({shape:v,current:!1,hash:vr(v,u,!1,d)}));a&&g.push({shape:a,current:!0,hash:vr(a,u,!0,d)});const h=g.map(v=>v.hash).join(";");if(h===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=h;const M=r.querySelector("defs"),A=r.querySelector("g"),k=n.querySelector("g");ui(i,g,M),er(g.filter(v=>!v.shape.customSvg),A,v=>Sr(e,v,i.brushes,u,d)),er(g.filter(v=>v.shape.customSvg),k,v=>Sr(e,v,i.brushes,u,d))}function ui(e,r,n){const i=new Map;let t;for(const d of r)d.shape.dest&&(t=e.brushes[d.shape.brush],d.shape.modifiers&&(t=cn(t,d.shape.modifiers)),i.set(t.key,t));const a=new Set;let u=n.firstChild;for(;u;)a.add(u.getAttribute("cgKey")),u=u.nextSibling;for(const[d,I]of i.entries())a.has(d)||n.appendChild(Mi(I))}function vr({orig:e,dest:r,brush:n,piece:i,modifiers:t,customSvg:a},u,d,I){return[I.width,I.height,d,e,r,n,r&&(u.get(r)||0)>1,i&&si(i),t&&di(t),a&&fi(a)].filter(g=>g).join(",")}function si(e){return[e.color,e.role,e.scale].filter(r=>r).join(",")}function di(e){return""+(e.lineWidth||"")}function fi(e){let r=0;for(let n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n)>>>0;return"custom-"+r.toString()}function Sr(e,{shape:r,current:n,hash:i},t,a,u){let d;const I=br(E(r.orig),e.orientation);if(r.customSvg)d=gi(r.customSvg,I,u);else if(r.dest){let g=t[r.brush];r.modifiers&&(g=cn(g,r.modifiers)),d=Ii(g,I,br(E(r.dest),e.orientation),n,(a.get(r.dest)||0)>1,u)}else d=pi(t[r.brush],I,n,u);return d.setAttribute("cgHash",i),d}function gi(e,r,n){const[i,t]=Be(r,n),a=Me($("g"),{transform:`translate(${i},${t})`}),u=Me($("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return a.appendChild(u),u.innerHTML=e,a}function pi(e,r,n,i){const t=Be(r,i),a=mi(),u=(i.width+i.height)/(4*Math.max(i.width,i.height));return Me($("circle"),{stroke:e.color,"stroke-width":a[n?0:1],fill:"none",opacity:ln(e,n),cx:t[0],cy:t[1],r:u-a[1]/2})}function Ii(e,r,n,i,t,a){const u=vi(t&&!i),d=Be(r,a),I=Be(n,a),g=I[0]-d[0],h=I[1]-d[1],M=Math.atan2(h,g),A=Math.cos(M)*u,k=Math.sin(M)*u;return Me($("line"),{stroke:e.color,"stroke-width":hi(e,i),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:ln(e,i),x1:d[0],y1:d[1],x2:I[0]-A,y2:I[1]-k})}function Mi(e){const r=Me($("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return r.appendChild(Me($("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),r.setAttribute("cgKey",e.key),r}function Me(e,r){for(const n in r)e.setAttribute(n,r[n]);return e}function br(e,r){return r==="white"?e:[7-e[0],7-e[1]]}function cn(e,r){return{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(r.lineWidth||e.lineWidth),key:[e.key,r.lineWidth].filter(n=>n).join("")}}function mi(){return[3/64,4/64]}function hi(e,r){return(e.lineWidth||10)*(r?.85:1)/64}function ln(e,r){return(e.opacity||1)*(r?.9:1)}function vi(e){return(e?20:10)/64}function Be(e,r){const n=Math.min(1,r.width/r.height),i=Math.min(1,r.height/r.width);return[(e[0]-3.5)*n,(3.5-e[1])*i]}function Si(e,r){e.innerHTML="",e.classList.add("cg-wrap");for(const I of Sn)e.classList.toggle("orientation-"+I,r.orientation===I);e.classList.toggle("manipulable",!r.viewOnly);const n=ce("cg-container");e.appendChild(n);const i=ce("cg-board");n.appendChild(i);let t,a,u;if(r.drawable.visible&&(t=Me($("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),t.appendChild($("defs")),t.appendChild($("g")),a=Me($("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),a.appendChild($("g")),u=ce("cg-auto-pieces"),n.appendChild(t),n.appendChild(a),n.appendChild(u)),r.coordinates){const I=r.orientation==="black"?" black":"",g=r.ranksPosition==="left"?" left":"";n.appendChild(wr(nr,"ranks"+I+g)),n.appendChild(wr(rr,"files"+I))}let d;return r.draggable.showGhost&&(d=ce("piece","ghost"),or(d,!1),n.appendChild(d)),{board:i,container:n,wrap:e,ghost:d,svg:t,customSvg:a,autoPieces:u}}function wr(e,r){const n=ce("coords",r);let i;for(const t of e)i=ce("coord"),i.textContent=t,n.appendChild(i);return n}function bi(e,r){if(!e.dropmode.active)return;me(e),he(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const i=ye(r),t=i&&Le(i,Y(e),e.dom.bounds());t&&Vr(e,"a0",t)}e.dom.redraw()}function wi(e,r){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(r).observe(e.dom.elements.wrap),e.viewOnly)return;const i=Li(e);n.addEventListener("touchstart",i,{passive:!1}),n.addEventListener("mousedown",i,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",t=>t.preventDefault())}function yi(e,r){const n=[];if("ResizeObserver"in window||n.push(Pe(document.body,"chessground.resize",r)),!e.viewOnly){const i=yr(e,ii,qn),t=yr(e,ti,Kn);for(const u of["touchmove","mousemove"])n.push(Pe(document,u,i));for(const u of["touchend","mouseup"])n.push(Pe(document,u,t));const a=()=>e.dom.bounds.clear();n.push(Pe(document,"scroll",a,{capture:!0,passive:!0})),n.push(Pe(window,"resize",a,{passive:!0}))}return()=>n.forEach(i=>i())}function Pe(e,r,n,i){return e.addEventListener(r,n,i),()=>e.removeEventListener(r,n,i)}function Li(e){return r=>{e.draggable.current?We(e):e.drawable.current?nn(e):r.shiftKey||Ur(r)?e.drawable.enabled&&Jn(e,r):e.viewOnly||(e.dropmode.active?bi(e,r):ei(e,r))}}function yr(e,r,n){return i=>{e.drawable.current?e.drawable.enabled&&n(e,i):e.viewOnly||r(e,i)}}function Ni(e){const r=Y(e),n=Ue(e.dom.bounds()),i=e.dom.elements.board,t=e.pieces,a=e.animation.current,u=a?a.plan.anims:new Map,d=a?a.plan.fadings:new Map,I=e.draggable.current,g=Di(e),h=new Set,M=new Set,A=new Map,k=new Map;let v,w,z,ee,R,le,Ne,J,Ae,_;for(w=i.firstChild;w;){if(v=w.cgKey,un(w))if(z=t.get(v),R=u.get(v),le=d.get(v),ee=w.cgPiece,w.cgDragging&&(!I||I.orig!==v)&&(w.classList.remove("dragging"),oe(w,n(E(v),r)),w.cgDragging=!1),!le&&w.cgFading&&(w.cgFading=!1,w.classList.remove("fading")),z){if(R&&w.cgAnimating&&ee===Ee(z)){const j=E(v);j[0]+=R[2],j[1]+=R[3],w.classList.add("anim"),oe(w,n(j,r))}else w.cgAnimating&&(w.cgAnimating=!1,w.classList.remove("anim"),oe(w,n(E(v),r)),e.addPieceZIndex&&(w.style.zIndex=Ve(E(v),r)));ee===Ee(z)&&(!le||!w.cgFading)?h.add(v):le&&ee===Ee(le)?(w.classList.add("fading"),w.cgFading=!0):Je(A,ee,w)}else Je(A,ee,w);else if(sn(w)){const j=w.className;g.get(v)===j?M.add(v):Je(k,j,w)}w=w.nextSibling}for(const[j,V]of g)if(!M.has(j)){Ae=k.get(V),_=Ae&&Ae.pop();const G=n(E(j),r);if(_)_.cgKey=j,oe(_,G);else{const W=ce("square",V);W.cgKey=j,oe(W,G),i.insertBefore(W,i.firstChild)}}for(const[j,V]of t)if(R=u.get(j),!h.has(j))if(Ne=A.get(Ee(V)),J=Ne&&Ne.pop(),J){J.cgKey=j,J.cgFading&&(J.classList.remove("fading"),J.cgFading=!1);const G=E(j);e.addPieceZIndex&&(J.style.zIndex=Ve(G,r)),R&&(J.cgAnimating=!0,J.classList.add("anim"),G[0]+=R[2],G[1]+=R[3]),oe(J,n(G,r))}else{const G=Ee(V),W=ce("piece",G),ue=E(j);W.cgPiece=G,W.cgKey=j,R&&(W.cgAnimating=!0,ue[0]+=R[2],ue[1]+=R[3]),oe(W,n(ue,r)),e.addPieceZIndex&&(W.style.zIndex=Ve(ue,r)),i.appendChild(W)}for(const j of A.values())Nr(e,j);for(const j of k.values())Nr(e,j)}function Ai(e){const r=Y(e),n=Ue(e.dom.bounds());let i=e.dom.elements.board.firstChild;for(;i;)(un(i)&&!i.cgAnimating||sn(i))&&oe(i,n(E(i.cgKey),r)),i=i.nextSibling}function Lr(e){const r=e.dom.elements.wrap.getBoundingClientRect(),n=e.dom.elements.container,i=r.height/r.width,t=Math.floor(r.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,a=t*i;n.style.width=t+"px",n.style.height=a+"px",e.dom.bounds.clear(),e.addDimensionsCssVars&&(document.documentElement.style.setProperty("--cg-width",t+"px"),document.documentElement.style.setProperty("--cg-height",a+"px"))}function un(e){return e.tagName==="PIECE"}function sn(e){return e.tagName==="SQUARE"}function Nr(e,r){for(const n of r)e.dom.elements.board.removeChild(n)}function Ve(e,r){const i=e[1];return`${r?3+7-i:3+i}`}function Ee(e){return`${e.color} ${e.role}`}function Di(e){var r;const n=new Map;if(e.lastMove&&e.highlight.lastMove)for(const a of e.lastMove)de(n,a,"last-move");if(e.check&&e.highlight.check&&de(n,e.check,"check"),e.selected&&(de(n,e.selected,"selected"),e.movable.showDests)){const a=(r=e.movable.dests)===null||r===void 0?void 0:r.get(e.selected);if(a)for(const d of a)de(n,d,"move-dest"+(e.pieces.has(d)?" oc":""));const u=e.premovable.dests;if(u)for(const d of u)de(n,d,"premove-dest"+(e.pieces.has(d)?" oc":""))}const i=e.premovable.current;if(i)for(const a of i)de(n,a,"current-premove");else e.predroppable.current&&de(n,e.predroppable.current.key,"current-premove");const t=e.exploding;if(t)for(const a of t.keys)de(n,a,"exploding"+t.stage);return n}function de(e,r,n){const i=e.get(r);i?e.set(r,`${i} ${n}`):e.set(r,n)}function Je(e,r,n){const i=e.get(r);i?i.push(n):e.set(r,[n])}function ji(e,r){const i=e.drawable.autoShapes.filter(t=>t.piece).map(t=>({shape:t,hash:Ci(t),current:!1}));er(i,r,t=>xi(e,t,e.dom.bounds()))}function Ti(e){var r;const n=Y(e),i=Ue(e.dom.bounds());let t=(r=e.dom.elements.autoPieces)===null||r===void 0?void 0:r.firstChild;for(;t;)Zr(t,i(E(t.cgKey),n),t.cgScale),t=t.nextSibling}function xi(e,{shape:r,hash:n},i){var t,a,u;const d=r.orig,I=(t=r.piece)===null||t===void 0?void 0:t.role,g=(a=r.piece)===null||a===void 0?void 0:a.color,h=(u=r.piece)===null||u===void 0?void 0:u.scale,M=ce("piece",`${I} ${g}`);return M.setAttribute("cgHash",n),M.cgKey=d,M.cgScale=h,Zr(M,Ue(i)(E(d),Y(e)),h),M}function Ci(e){var r,n,i;return[e.orig,(r=e.piece)===null||r===void 0?void 0:r.role,(n=e.piece)===null||n===void 0?void 0:n.color,(i=e.piece)===null||i===void 0?void 0:i.scale].join(",")}function Pi(e,r){const n=ci();$r(n,r||{});function i(){const t="dom"in n?n.dom.unbind:void 0,a=Si(e,n),u=wn(()=>a.board.getBoundingClientRect()),d=h=>{Ni(g),a.autoPieces&&ji(g,a.autoPieces),!h&&a.svg&&li(g,a.svg,a.customSvg)},I=()=>{Lr(g),Ai(g),a.autoPieces&&Ti(g)},g=n;return g.dom={elements:a,bounds:u,redraw:Ei(d),redrawNow:d,unbind:t},g.drawable.prevSvgHash="",Lr(g),d(!1),wi(g,I),t||(g.dom.unbind=yi(g,I)),g.events.insert&&g.events.insert(a),g}return ai(i(),i)}function Ei(e){let r=!1;return()=>{r||(r=!0,requestAnimationFrame(()=>{e(),r=!1}))}}const ki=Cr({__name:"Chessboard",props:{config:null},emits:["ready"],setup(e,{emit:r}){const{config:n}=e;let i=pn(null);function t(){let{value:a}=i;if(a){let u=a.parentElement;u.removeChild(a);let{width:d,height:I}=u.getBoundingClientRect();a.style.width=Math.min(d,I)+"px",a.style.height=Math.min(d,I)+"px",u.appendChild(a)}}return In(()=>{if(i.value){t(),window.addEventListener("resize",t);let a=Pi(i.value,n);r("ready",a)}}),Mn(()=>{window.removeEventListener("resize",t)}),(a,u)=>(Pr(),Er(hn,{"explicit-height":"",flexbox:""},{nav:Fe(()=>[kr(a.$slots,"nav",{},void 0,!0)]),default:Fe(()=>[mn("div",{ref_key:"boardEl",ref:i,class:"chessboard"},null,512)]),_:3}))}});var zi=gn(ki,[["__scopeId","data-v-7122605e"]]);const Zi="pnbrqkPNBRQK",qe="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",Ui=["1-0","0-1","1/2-1/2","*"],Ke={b:[16,32,17,15],w:[-16,-32,-17,-15]},Ar={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Hi=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Ri=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],_i={p:0,n:1,b:2,r:3,q:4,k:5},S={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},Wi=7,Bi=6,Gi=1,Qi=0,N={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},fe={w:[{square:N.a1,flag:S.QSIDE_CASTLE},{square:N.h1,flag:S.KSIDE_CASTLE}],b:[{square:N.a8,flag:S.QSIDE_CASTLE},{square:N.h8,flag:S.KSIDE_CASTLE}]},Oi=0,Dr=1;function Yi(e,r){for(var n=e.from,i=e.to,t=e.piece,a=0,u=0,d=0,I=0,g=r.length;I<g;I++){var h=r[I].from,M=r[I].to,A=r[I].piece;t===A&&n!==h&&i===M&&(a++,Ie(n)===Ie(h)&&u++,Ze(n)===Ze(h)&&d++)}return a>0?u>0&&d>0?Q(n):d>0?Q(n).charAt(1):Q(n).charAt(0):""}function Vi(e){var r=e.charAt(0);if(r>="a"&&r<="h"){var n=e.match(/[a-h]\d.*[a-h]\d/);return n?void 0:ie}return r=r.toLowerCase(),r==="o"?je:r}function jr(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function Ie(e){return e>>4}function Ze(e){return e&15}function Q(e){var r=Ze(e),n=Ie(e);return"abcdefgh".substring(r,r+1)+"87654321".substring(n,n+1)}function ke(e){return e===te?pe:te}function Ji(e){return"0123456789".indexOf(e)!==-1}function dn(e){var r=e instanceof Array?[]:{};for(var n in e)typeof n=="object"?r[n]=dn(e[n]):r[n]=e[n];return r}function Tr(e){return e.replace(/^\s+|\s+$/g,"")}const pe="b",te="w",X=-1,ie="p",xr="n",_e="b",qi="r",Ki="q",je="k",Fi=function(){for(var e=[],r=N.a8;r<=N.h1;r++){if(r&136){r+=7;continue}e.push(Q(r))}return e}(),Xi={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},$i=function(e){var r=new Array(128),n={w:X,b:X},i=te,t={w:0,b:0},a=X,u=0,d=1,I=[],g={},h={};v(typeof e=="undefined"?qe:e);function M(o){typeof o=="undefined"&&(o=!1),r=new Array(128),n={w:X,b:X},i=te,t={w:0,b:0},a=X,u=0,d=1,I=[],o||(g={}),h={},R(z())}function A(){for(var o=[],c={},l=function(s){s in h&&(c[s]=h[s])};I.length>0;)o.push(se());for(l(z());o.length>0;)ae(o.pop()),l(z());h=c}function k(){v(qe)}function v(o,c){typeof c=="undefined"&&(c=!1);var l=o.split(/\s+/),s=l[0],p=0;if(!w(o).valid)return!1;M(c);for(var f=0;f<s.length;f++){var m=s.charAt(f);if(m==="/")p+=8;else if(Ji(m))p+=parseInt(m,10);else{var y=m<"a"?te:pe;Ne({type:m.toLowerCase(),color:y},Q(p)),p++}}return i=l[1],l[2].indexOf("K")>-1&&(t.w|=S.KSIDE_CASTLE),l[2].indexOf("Q")>-1&&(t.w|=S.QSIDE_CASTLE),l[2].indexOf("k")>-1&&(t.b|=S.KSIDE_CASTLE),l[2].indexOf("q")>-1&&(t.b|=S.QSIDE_CASTLE),a=l[3]==="-"?X:N[l[3]],u=parseInt(l[4],10),d=parseInt(l[5],10),R(z()),!0}function w(o){var c={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"Illegal en-passant square"},l=o.split(/\s+/);if(l.length!==6)return{valid:!1,error_number:1,error:c[1]};if(isNaN(l[5])||parseInt(l[5],10)<=0)return{valid:!1,error_number:2,error:c[2]};if(isNaN(l[4])||parseInt(l[4],10)<0)return{valid:!1,error_number:3,error:c[3]};if(!/^(-|[abcdefgh][36])$/.test(l[3]))return{valid:!1,error_number:4,error:c[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(l[2]))return{valid:!1,error_number:5,error:c[5]};if(!/^(w|b)$/.test(l[1]))return{valid:!1,error_number:6,error:c[6]};var s=l[0].split("/");if(s.length!==8)return{valid:!1,error_number:7,error:c[7]};for(var p=0;p<s.length;p++){for(var f=0,m=!1,y=0;y<s[p].length;y++)if(isNaN(s[p][y])){if(!/^[prnbqkPRNBQK]$/.test(s[p][y]))return{valid:!1,error_number:9,error:c[9]};f+=1,m=!1}else{if(m)return{valid:!1,error_number:8,error:c[8]};f+=parseInt(s[p][y],10),m=!0}if(f!==8)return{valid:!1,error_number:10,error:c[10]}}return l[3][1]=="3"&&l[1]=="w"||l[3][1]=="6"&&l[1]=="b"?{valid:!1,error_number:11,error:c[11]}:{valid:!0,error_number:0,error:c[0]}}function z(){for(var o=0,c="",l=N.a8;l<=N.h1;l++){if(r[l]==null)o++;else{o>0&&(c+=o,o=0);var s=r[l].color,p=r[l].type;c+=s===te?p.toUpperCase():p.toLowerCase()}l+1&136&&(o>0&&(c+=o),l!==N.h1&&(c+="/"),o=0,l+=8)}var f="";t[te]&S.KSIDE_CASTLE&&(f+="K"),t[te]&S.QSIDE_CASTLE&&(f+="Q"),t[pe]&S.KSIDE_CASTLE&&(f+="k"),t[pe]&S.QSIDE_CASTLE&&(f+="q"),f=f||"-";var m=a===X?"-":Q(a);return[c,i,f,m,u,d].join(" ")}function ee(o){for(var c=0;c<o.length;c+=2)typeof o[c]=="string"&&typeof o[c+1]=="string"&&(g[o[c]]=o[c+1]);return g}function R(o){I.length>0||(o!==qe?(g.SetUp="1",g.FEN=o):(delete g.SetUp,delete g.FEN))}function le(o){var c=r[N[o]];return c?{type:c.type,color:c.color}:null}function Ne(o,c){if(!("type"in o&&"color"in o)||Zi.indexOf(o.type.toLowerCase())===-1||!(c in N))return!1;var l=N[c];return o.type==je&&!(n[o.color]==X||n[o.color]==l)?!1:(r[l]={type:o.type,color:o.color},o.type===je&&(n[o.color]=l),R(z()),!0)}function J(o){var c=le(o);return r[N[o]]=null,c&&c.type===je&&(n[c.color]=X),R(z()),c}function Ae(o,c,l,s,p){var f={color:i,from:c,to:l,flags:s,piece:o[c].type};return p&&(f.flags|=S.PROMOTION,f.promotion=p),o[l]?f.captured=o[l].type:s&S.EP_CAPTURE&&(f.captured=ie),f}function _(o){function c(ne,Te,C,B,De){if(ne[C].type===ie&&(Ie(B)===Qi||Ie(B)===Wi))for(var xe=[Ki,qi,_e,xr],Se=0,Ce=xe.length;Se<Ce;Se++)Te.push(Ae(ne,C,B,De,xe[Se]));else Te.push(Ae(ne,C,B,De))}var l=[],s=i,p=ke(s),f={b:Gi,w:Bi},m=N.a8,y=N.h1,D=!1,P=typeof o!="undefined"&&"legal"in o?o.legal:!0,U=typeof o!="undefined"&&"piece"in o&&typeof o.piece=="string"?o.piece.toLowerCase():!0;if(typeof o!="undefined"&&"square"in o)if(o.square in N)m=y=N[o.square],D=!0;else return[];for(var b=m;b<=y;b++){if(b&136){b+=7;continue}var T=r[b];if(!(T==null||T.color!==s)){if(T.type===ie&&(U===!0||U===ie)){var L=b+Ke[s][0];if(r[L]==null){c(r,l,b,L,S.NORMAL);var L=b+Ke[s][1];f[s]===Ie(b)&&r[L]==null&&c(r,l,b,L,S.BIG_PAWN)}for(x=2;x<4;x++){var L=b+Ke[s][x];L&136||(r[L]!=null&&r[L].color===p?c(r,l,b,L,S.CAPTURE):L===a&&c(r,l,b,a,S.EP_CAPTURE))}}else if(U===!0||U===T.type)for(var x=0,Z=Ar[T.type].length;x<Z;x++)for(var F=Ar[T.type][x],L=b;L+=F,!(L&136);){if(r[L]==null)c(r,l,b,L,S.NORMAL);else{if(r[L].color===s)break;c(r,l,b,L,S.CAPTURE);break}if(T.type==="n"||T.type==="k")break}}}if((U===!0||U===je)&&(!D||y===n[s])){if(t[s]&S.KSIDE_CASTLE){var H=n[s],re=H+2;r[H+1]==null&&r[re]==null&&!V(p,n[s])&&!V(p,H+1)&&!V(p,re)&&c(r,l,n[s],re,S.KSIDE_CASTLE)}if(t[s]&S.QSIDE_CASTLE){var H=n[s],re=H-2;r[H-1]==null&&r[H-2]==null&&r[H-3]==null&&!V(p,n[s])&&!V(p,H-1)&&!V(p,re)&&c(r,l,n[s],re,S.QSIDE_CASTLE)}}if(!P)return l;for(var ve=[],b=0,Z=l.length;b<Z;b++)ae(l[b]),G(s)||ve.push(l[b]),se();return ve}function j(o,c){var l="";if(o.flags&S.KSIDE_CASTLE)l="O-O";else if(o.flags&S.QSIDE_CASTLE)l="O-O-O";else{if(o.piece!==ie){var s=Yi(o,c);l+=o.piece.toUpperCase()+s}o.flags&(S.CAPTURE|S.EP_CAPTURE)&&(o.piece===ie&&(l+=Q(o.from)[0]),l+="x"),l+=Q(o.to),o.flags&S.PROMOTION&&(l+="="+o.promotion.toUpperCase())}return ae(o),W()&&(ue()?l+="#":l+="+"),se(),l}function V(o,c){for(var l=N.a8;l<=N.h1;l++){if(l&136){l+=7;continue}if(!(r[l]==null||r[l].color!==o)){var s=r[l],p=l-c,f=p+119;if(Hi[f]&1<<_i[s.type]){if(s.type===ie){if(p>0){if(s.color===te)return!0}else if(s.color===pe)return!0;continue}if(s.type==="n"||s.type==="k")return!0;for(var m=Ri[f],y=l+m,D=!1;y!==c;){if(r[y]!=null){D=!0;break}y+=m}if(!D)return!0}}}return!1}function G(o){return V(ke(o),n[o])}function W(){return G(i)}function ue(){return W()&&_().length===0}function Ge(){return!W()&&_().length===0}function Qe(){for(var o={},c=[],l=0,s=0,p=N.a8;p<=N.h1;p++){if(s=(s+1)%2,p&136){p+=7;continue}var f=r[p];f&&(o[f.type]=f.type in o?o[f.type]+1:1,f.type===_e&&c.push(s),l++)}if(l===2)return!0;if(l===3&&(o[_e]===1||o[xr]===1))return!0;if(l===o[_e]+2){for(var m=0,y=c.length,p=0;p<y;p++)m+=c[p];if(m===0||m===y)return!0}return!1}function Oe(){for(var o=[],c={},l=!1;;){var s=se();if(!s)break;o.push(s)}for(;;){var p=z().split(" ").slice(0,4).join(" ");if(c[p]=p in c?c[p]+1:1,c[p]>=3&&(l=!0),!o.length)break;ae(o.pop())}return l}function fn(o){I.push({move:o,kings:{b:n.b,w:n.w},turn:i,castling:{b:t.b,w:t.w},ep_square:a,half_moves:u,move_number:d})}function ae(o){var c=i,l=ke(c);if(fn(o),r[o.to]=r[o.from],r[o.from]=null,o.flags&S.EP_CAPTURE&&(i===pe?r[o.to-16]=null:r[o.to+16]=null),o.flags&S.PROMOTION&&(r[o.to]={type:o.promotion,color:c}),r[o.to].type===je){if(n[r[o.to].color]=o.to,o.flags&S.KSIDE_CASTLE){var s=o.to-1,p=o.to+1;r[s]=r[p],r[p]=null}else if(o.flags&S.QSIDE_CASTLE){var s=o.to+1,p=o.to-2;r[s]=r[p],r[p]=null}t[c]=""}if(t[c]){for(var f=0,m=fe[c].length;f<m;f++)if(o.from===fe[c][f].square&&t[c]&fe[c][f].flag){t[c]^=fe[c][f].flag;break}}if(t[l]){for(var f=0,m=fe[l].length;f<m;f++)if(o.to===fe[l][f].square&&t[l]&fe[l][f].flag){t[l]^=fe[l][f].flag;break}}o.flags&S.BIG_PAWN?i==="b"?a=o.to-16:a=o.to+16:a=X,o.piece===ie||o.flags&(S.CAPTURE|S.EP_CAPTURE)?u=0:u++,i===pe&&d++,i=ke(i)}function se(){var o=I.pop();if(o==null)return null;var c=o.move;n=o.kings,i=o.turn,t=o.castling,a=o.ep_square,u=o.half_moves,d=o.move_number;var l=i,s=ke(i);if(r[c.from]=r[c.to],r[c.from].type=c.piece,r[c.to]=null,c.flags&S.CAPTURE)r[c.to]={type:c.captured,color:s};else if(c.flags&S.EP_CAPTURE){var p;l===pe?p=c.to-16:p=c.to+16,r[p]={type:ie,color:s}}if(c.flags&(S.KSIDE_CASTLE|S.QSIDE_CASTLE)){var f,m;c.flags&S.KSIDE_CASTLE?(f=c.to+1,m=c.to-1):c.flags&S.QSIDE_CASTLE&&(f=c.to-2,m=c.to+1),r[f]=r[m],r[m]=null}return c}function fr(o,c){for(var l=jr(o),s=0;s<2;s++){if(s==Dr){if(!c)return null;var p=!1,f=l.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(f){var m=f[1],y=f[2],D=f[3],P=f[4];y.length==1&&(p=!0)}else{var f=l.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/);if(f){var m=f[1],y=f[2],D=f[3],P=f[4];if(y.length==1)var p=!0}}}for(var U=Vi(l),b=_({legal:!0,piece:m||U}),T=0,L=b.length;T<L;T++)switch(s){case Oi:{if(l===jr(j(b[T],b)))return b[T];break}case Dr:if(f){if((!m||m.toLowerCase()==b[T].piece)&&N[y]==b[T].from&&N[D]==b[T].to&&(!P||P.toLowerCase()==b[T].promotion))return b[T];if(p){var x=Q(b[T].from);if((!m||m.toLowerCase()==b[T].piece)&&N[D]==b[T].to&&(y==x[0]||y==x[1])&&(!P||P.toLowerCase()==b[T].promotion))return b[T]}}}}return null}function He(o){var c=dn(o);c.san=j(c,_({legal:!0})),c.to=Q(c.to),c.from=Q(c.from);var l="";for(var s in S)S[s]&c.flags&&(l+=Xi[s]);return c.flags=l,c}function gr(o){for(var c=_({legal:!1}),l=0,s=i,p=0,f=c.length;p<f;p++){if(ae(c[p]),!G(s))if(o-1>0){var m=gr(o-1);l+=m}else l++;se()}return l}return{load:function(o){return v(o)},reset:function(){return k()},moves:function(o){for(var c=_(o),l=[],s=0,p=c.length;s<p;s++)typeof o!="undefined"&&"verbose"in o&&o.verbose?l.push(He(c[s])):l.push(j(c[s],_({legal:!0})));return l},in_check:function(){return W()},in_checkmate:function(){return ue()},in_stalemate:function(){return Ge()},in_draw:function(){return u>=100||Ge()||Qe()||Oe()},insufficient_material:function(){return Qe()},in_threefold_repetition:function(){return Oe()},game_over:function(){return u>=100||ue()||Ge()||Qe()||Oe()},validate_fen:function(o){return w(o)},fen:function(){return z()},board:function(){for(var o=[],c=[],l=N.a8;l<=N.h1;l++)r[l]==null?c.push(null):c.push({square:Q(l),type:r[l].type,color:r[l].color}),l+1&136&&(o.push(c),c=[],l+=8);return o},pgn:function(o){var c=typeof o=="object"&&typeof o.newline_char=="string"?o.newline_char:`
`,l=typeof o=="object"&&typeof o.max_width=="number"?o.max_width:0,s=[],p=!1;for(var f in g)s.push("["+f+' "'+g[f]+'"]'+c),p=!0;p&&I.length&&s.push(c);for(var m=function(x){var Z=h[z()];if(typeof Z!="undefined"){var F=x.length>0?" ":"";x=`${x}${F}{${Z}}`}return x},y=[];I.length>0;)y.push(se());var D=[],P="";for(y.length===0&&D.push(m(""));y.length>0;){P=m(P);var U=y.pop();!I.length&&U.color==="b"?P=d+". ...":U.color==="w"&&(P.length&&D.push(P),P=d+"."),P=P+" "+j(U,_({legal:!0})),ae(U)}if(P.length&&D.push(m(P)),typeof g.Result!="undefined"&&D.push(g.Result),l===0)return s.join("")+D.join(" ");for(var b=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},T=function(x,Z){for(var F of Z.split(" "))if(!!F){if(x+F.length>l){for(;b();)x--;s.push(c),x=0}s.push(F),x+=F.length,s.push(" "),x++}return b()&&x--,x},L=0,f=0;f<D.length;f++){if(L+D[f].length>l&&D[f].includes("{")){L=T(L,D[f]);continue}L+D[f].length>l&&f!==0?(s[s.length-1]===" "&&s.pop(),s.push(c),L=0):f!==0&&(s.push(" "),L++),s.push(D[f]),L+=D[f].length}return s.join("")},load_pgn:function(o,c){var l=typeof c!="undefined"&&"sloppy"in c?c.sloppy:!1;function s(C){return C.replace(/\\/g,"\\")}function p(C,B){for(var De=typeof B=="object"&&typeof B.newline_char=="string"?B.newline_char:`\r?
`,xe={},Se=C.split(new RegExp(s(De))),Ce="",pr="",Re=0;Re<Se.length;Re++){var Ir=/^\s*\[([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;Ce=Se[Re].replace(Ir,"$1"),pr=Se[Re].replace(Ir,"$2"),Tr(Ce).length>0&&(xe[Ce]=pr)}return xe}o=o.trim();var f=typeof c=="object"&&typeof c.newline_char=="string"?c.newline_char:`\r?
`,m=new RegExp("^(\\[((?:"+s(f)+")|.)*\\])(?:\\s*"+s(f)+"){2}"),y=m.test(o)?m.exec(o)[1]:"";k();var D=p(y,c),P="";for(var U in D)U.toLowerCase()==="fen"&&(P=D[U]),ee([U,D[U]]);if(l){if(P&&!v(P,!0))return!1}else if(D.SetUp==="1"&&!("FEN"in D&&v(D.FEN,!0)))return!1;for(var b=function(C){return Array.from(C).map(function(B){return B.charCodeAt(0)<128?B.charCodeAt(0).toString(16):encodeURIComponent(B).replace(/\%/g,"").toLowerCase()}).join("")},T=function(C){return C.length==0?"":decodeURIComponent("%"+C.match(/.{1,2}/g).join("%"))},L=function(C){return C=C.replace(new RegExp(s(f),"g")," "),`{${b(C.slice(1,C.length-1))}}`},x=function(C){if(C.startsWith("{")&&C.endsWith("}"))return T(C.slice(1,C.length-1))},Z=o.replace(y,"").replace(new RegExp(`({[^}]*})+?|;([^${s(f)}]*)`,"g"),function(C,B,De){return B!==void 0?L(B):" "+L(`{${De.slice(1)}}`)}).replace(new RegExp(s(f),"g")," "),F=/(\([^\(\)]+\))+?/g;F.test(Z);)Z=Z.replace(F,"");Z=Z.replace(/\d+\.(\.\.)?/g,""),Z=Z.replace(/\.\.\./g,""),Z=Z.replace(/\$\d+/g,"");var H=Tr(Z).split(new RegExp(/\s+/));H=H.join(",").replace(/,,+/g,",").split(",");for(var re="",ve="",ne=0;ne<H.length;ne++){var Te=x(H[ne]);if(Te!==void 0){h[z()]=Te;continue}if(re=fr(H[ne],l),re==null)if(Ui.indexOf(H[ne])>-1)ve=H[ne];else return!1;else ve="",ae(re)}return ve&&Object.keys(g).length&&!g.Result&&ee(["Result",ve]),!0},header:function(){return ee(arguments)},turn:function(){return i},move:function(o,c){var l=typeof c!="undefined"&&"sloppy"in c?c.sloppy:!1,s=null;if(typeof o=="string")s=fr(o,l);else if(typeof o=="object"){for(var p=_(),f=0,m=p.length;f<m;f++)if(o.from===Q(p[f].from)&&o.to===Q(p[f].to)&&(!("promotion"in p[f])||o.promotion===p[f].promotion)){s=p[f];break}}if(!s)return null;var y=He(s);return ae(s),y},undo:function(){var o=se();return o?He(o):null},clear:function(){return M()},put:function(o,c){return Ne(o,c)},get:function(o){return le(o)},ascii(){for(var o=`   +------------------------+
`,c=N.a8;c<=N.h1;c++){if(Ze(c)===0&&(o+=" "+"87654321"[Ie(c)]+" |"),r[c]==null)o+=" . ";else{var l=r[c].type,s=r[c].color,p=s===te?l.toUpperCase():l.toLowerCase();o+=" "+p+" "}c+1&136&&(o+=`|
`,c+=8)}return o+=`   +------------------------+
`,o+="     a  b  c  d  e  f  g  h",o},remove:function(o){return J(o)},perft:function(o){return gr(o)},square_color:function(o){if(o in N){var c=N[o];return(Ie(c)+Ze(c))%2===0?"light":"dark"}return null},history:function(o){for(var c=[],l=[],s=typeof o!="undefined"&&("verbose"in o)&&o.verbose;I.length>0;)c.push(se());for(;c.length>0;){var p=c.pop();s?l.push(He(p)):l.push(j(p,_({legal:!0}))),ae(p)}return l},get_comment:function(){return h[z()]},set_comment:function(o){h[z()]=o.replace("{","[").replace("}","]")},delete_comment:function(){var o=h[z()];return delete h[z()],o},get_comments:function(){return A(),Object.keys(h).map(function(o){return{fen:o,comment:h[o]}})},delete_comments:function(){return A(),Object.keys(h).map(function(o){var c=h[o];return delete h[o],{fen:o,comment:c}})}}},rt=Cr({__name:"LegalMoveChessboard",props:{position:null,orientation:null,destinations:null},emits:["ready","move"],setup(e,{emit:r}){const{position:n,orientation:i="white",destinations:t}=e;async function a(M,A){if(M=="a0"||A=="a0"||!u)return;if(t){let w=u.state.pieces.get(M);w&&(u.state.pieces.delete(M),u.state.pieces.set(A,w)),d.load(`${u.getFen()} ${d.turn()=="w"?"b":"w"} - - 0 1`)}else d.move({from:M,to:A,promotion:"q"},{sloppy:!0});u.set({turnColor:d.turn()==="w"?"white":"black",fen:d.fen(),check:d.in_check(),lastMove:[M,A],movable:{color:d.turn()==="w"?"white":"black",dests:new Map}});let k;r("move",w=>k=w,d,u);let v=await k;v?setTimeout(()=>a(v.from,v.to)):u.set({movable:{dests:g()}})}let u,d=$i(n),I={fen:d.fen().split(" ")[0],orientation:i,premovable:{enabled:!1},turnColor:d.turn()==="w"?"white":"black",movable:{free:!1,color:d.turn()==="w"?"white":"black",dests:new Map,events:{after:a}}};function g(){if(t)return t(d);let M=new Map;for(let A of Fi){let k=d.moves({square:A,verbose:!0});k.length&&M.set(A,k.map(({to:v})=>v))}return M}async function h(M){u=M,r("ready",u,d);let A;r("move",v=>A=v,d,u);let k=await A;k?setTimeout(()=>a(k.from,k.to)):u.set({turnColor:d.turn()==="w"?"white":"black",check:d.in_check(),movable:{color:d.turn()==="w"?"white":"black",dests:g()}})}return(M,A)=>(Pr(),Er(zi,{config:vn(I),onReady:h},{nav:Fe(()=>[kr(M.$slots,"nav")]),_:3},8,["config"]))}});export{Fi as S,rt as _};
