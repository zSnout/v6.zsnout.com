import{_ as pn,d as Or,r as hn,m as vn,y as gn,o as xr,e as Ir,w as Ye,g as Nr,b as mn,D as bn,u as wn}from"./index.c9fd9174.js";const yn=["white","black"],rr=["a","b","c","d","e","f","g","h"],nr=["1","2","3","4","5","6","7","8"],_n=[...nr].reverse(),or=Array.prototype.concat(...rr.map(e=>nr.map(r=>e+r))),V=e=>or[8*e[0]+e[1]],I=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],Lr=or.map(I);function Sn(e){let r;const n=()=>(r===void 0&&(r=e()),r);return n.clear=()=>{r=void 0},n}const Cn=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const r=performance.now()-e;return e=void 0,r}}},tr=e=>e==="white"?"black":"white",Le=(e,r)=>{const n=e[0]-r[0],o=e[1]-r[1];return n*n+o*o},Xe=(e,r)=>e.role===r.role&&e.color===r.color,De=e=>(r,n)=>[(n?r[0]:7-r[0])*e.width/8,(n?7-r[1]:r[1])*e.height/8],ie=(e,r)=>{e.style.transform=`translate(${r[0]}px,${r[1]}px)`},qr=(e,r,n=1)=>{e.style.transform=`translate(${r[0]}px,${r[1]}px) scale(${n})`},ir=(e,r)=>{e.style.visibility=r?"visible":"hidden"},Ce=e=>{var r;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((r=e.targetTouches)===null||r===void 0)&&r[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},Dr=e=>e.buttons===2||e.button===2,le=(e,r)=>{const n=document.createElement(e);return r&&(n.className=r),n};function Kr(e,r,n){const o=I(e);return r||(o[0]=7-o[0],o[1]=7-o[1]),[n.left+n.width*o[0]/8+n.width/16,n.top+n.height*(7-o[1])/8+n.height/16]}const Se=(e,r)=>Math.abs(e-r),Pn=e=>(r,n,o,t)=>Se(r,o)<2&&(e==="white"?t===n+1||n<=1&&t===n+2&&r===o:t===n-1||n>=6&&t===n-2&&r===o),$r=(e,r,n,o)=>{const t=Se(e,n),a=Se(r,o);return t===1&&a===2||t===2&&a===1},Br=(e,r,n,o)=>Se(e,n)===Se(r,o),Ur=(e,r,n,o)=>e===n||r===o,Qr=(e,r,n,o)=>Br(e,r,n,o)||Ur(e,r,n,o),kn=(e,r,n)=>(o,t,a,s)=>Se(o,a)<2&&Se(t,s)<2||n&&t===s&&t===(e==="white"?0:7)&&(o===4&&(a===2&&r.includes(0)||a===6&&r.includes(7))||r.includes(a));function En(e,r){const n=r==="white"?"1":"8",o=[];for(const[t,a]of e)t[1]===n&&a.color===r&&a.role==="rook"&&o.push(I(t)[0]);return o}function Wr(e,r,n){const o=e.get(r);if(!o)return[];const t=I(r),a=o.role,s=a==="pawn"?Pn(o.color):a==="knight"?$r:a==="bishop"?Br:a==="rook"?Ur:a==="queen"?Qr:kn(o.color,En(e,o.color),n);return Lr.filter(f=>(t[0]!==f[0]||t[1]!==f[1])&&s(t[0],t[1],f[0],f[1])).map(V)}function F(e,...r){e&&setTimeout(()=>e(...r),1)}function An(e){e.orientation=tr(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Tn(e,r){for(const[n,o]of r)o?e.pieces.set(n,o):e.pieces.delete(n)}function Mn(e,r){if(e.check=void 0,r===!0&&(r=e.turnColor),r)for(const[n,o]of e.pieces)o.role==="king"&&o.color===r&&(e.check=n)}function Rn(e,r,n,o){be(e),e.premovable.current=[r,n],F(e.premovable.events.set,r,n,o)}function me(e){e.premovable.current&&(e.premovable.current=void 0,F(e.premovable.events.unset))}function On(e,r,n){me(e),e.predroppable.current={role:r,key:n},F(e.predroppable.events.set,r,n)}function be(e){const r=e.predroppable;r.current&&(r.current=void 0,F(r.events.unset))}function xn(e,r,n){if(!e.autoCastle)return!1;const o=e.pieces.get(r);if(!o||o.role!=="king")return!1;const t=I(r),a=I(n);if(t[1]!==0&&t[1]!==7||t[1]!==a[1])return!1;t[0]===4&&!e.pieces.has(n)&&(a[0]===6?n=V([7,a[1]]):a[0]===2&&(n=V([0,a[1]])));const s=e.pieces.get(n);return!s||s.color!==o.color||s.role!=="rook"?!1:(e.pieces.delete(r),e.pieces.delete(n),t[0]<a[0]?(e.pieces.set(V([6,a[1]]),o),e.pieces.set(V([5,a[1]]),s)):(e.pieces.set(V([2,a[1]]),o),e.pieces.set(V([3,a[1]]),s)),!0)}function Hr(e,r,n){const o=e.pieces.get(r),t=e.pieces.get(n);if(r===n||!o)return!1;const a=t&&t.color!==o.color?t:void 0;return n===e.selected&&Z(e),F(e.events.move,r,n,a),xn(e,r,n)||(e.pieces.set(n,o),e.pieces.delete(r)),e.lastMove=[r,n],e.check=void 0,F(e.events.change),a||!0}function ar(e,r,n,o){if(e.pieces.has(n))if(o)e.pieces.delete(n);else return!1;return F(e.events.dropNewPiece,r,n),e.pieces.set(n,r),e.lastMove=[n],e.check=void 0,F(e.events.change),e.movable.dests=void 0,e.turnColor=tr(e.turnColor),!0}function Fr(e,r,n){const o=Hr(e,r,n);return o&&(e.movable.dests=void 0,e.turnColor=tr(e.turnColor),e.animation.current=void 0),o}function jr(e,r,n){if(lr(e,r,n)){const o=Fr(e,r,n);if(o){const t=e.hold.stop();Z(e);const a={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:t};return o!==!0&&(a.captured=o),F(e.movable.events.after,r,n,a),!0}}else if(Nn(e,r,n))return Rn(e,r,n,{ctrlKey:e.stats.ctrlKey}),Z(e),!0;return Z(e),!1}function zr(e,r,n,o){const t=e.pieces.get(r);t&&(In(e,r,n)||o)?(e.pieces.delete(r),ar(e,t,n,o),F(e.movable.events.afterNewPiece,t.role,n,{premove:!1,predrop:!1})):t&&Ln(e,r,n)?On(e,t.role,n):(me(e),be(e)),e.pieces.delete(r),Z(e)}function Je(e,r,n){if(F(e.events.select,r),e.selected){if(e.selected===r&&!e.draggable.enabled){Z(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==r&&jr(e,e.selected,r)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(Vr(e,r)||cr(e,r))&&(Gr(e,r),e.hold.start())}function Gr(e,r){e.selected=r,cr(e,r)?e.premovable.dests=Wr(e.pieces,r,e.premovable.castle):e.premovable.dests=void 0}function Z(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function Vr(e,r){const n=e.pieces.get(r);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}const lr=(e,r,n)=>{var o,t;return r!==n&&Vr(e,r)&&(e.movable.free||!!(!((t=(o=e.movable.dests)===null||o===void 0?void 0:o.get(r))===null||t===void 0)&&t.includes(n)))};function In(e,r,n){const o=e.pieces.get(r);return!!o&&(r===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===o.color&&e.turnColor===o.color)}function cr(e,r){const n=e.pieces.get(r);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}const Nn=(e,r,n)=>r!==n&&cr(e,r)&&Wr(e.pieces,r,e.premovable.castle).includes(n);function Ln(e,r,n){const o=e.pieces.get(r),t=e.pieces.get(n);return!!o&&(!t||t.color!==e.movable.color)&&e.predroppable.enabled&&(o.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===o.color&&e.turnColor!==o.color}function qn(e,r){const n=e.pieces.get(r);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function Dn(e){const r=e.premovable.current;if(!r)return!1;const n=r[0],o=r[1];let t=!1;if(lr(e,n,o)){const a=Fr(e,n,o);if(a){const s={premove:!0};a!==!0&&(s.captured=a),F(e.movable.events.after,n,o,s),t=!0}}return me(e),t}function Kn(e,r){const n=e.predroppable.current;let o=!1;if(!n)return!1;if(r(n)){const t={role:n.role,color:e.movable.color};ar(e,t,n.key)&&(F(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),o=!0)}return be(e),o}function sr(e){me(e),be(e),Z(e)}function gr(e){e.movable.color=e.movable.dests=e.animation.current=void 0,sr(e)}function Pe(e,r,n){let o=Math.floor(8*(e[0]-n.left)/n.width);r||(o=7-o);let t=7-Math.floor(8*(e[1]-n.top)/n.height);return r||(t=7-t),o>=0&&o<8&&t>=0&&t<8?V([o,t]):void 0}function $n(e,r,n,o){const t=I(e),a=Lr.filter(p=>Qr(t[0],t[1],p[0],p[1])||$r(t[0],t[1],p[0],p[1])),f=a.map(p=>Kr(V(p),n,o)).map(p=>Le(r,p)),[,v]=f.reduce((p,b,g)=>p[0]<b?p:[b,g],[f[0],0]);return V(a[v])}const j=e=>e.orientation==="white",Zr="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Bn={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Un={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function Yr(e){e==="start"&&(e=Zr);const r=new Map;let n=7,o=0;for(const t of e)switch(t){case" ":case"[":return r;case"/":if(--n,n<0)return r;o=0;break;case"~":{const a=r.get(V([o-1,n]));a&&(a.promoted=!0);break}default:{const a=t.charCodeAt(0);if(a<57)o+=a-48;else{const s=t.toLowerCase();r.set(V([o,n]),{role:Bn[s],color:t===s?"black":"white"}),++o}}}return r}function Qn(e){return _n.map(r=>rr.map(n=>{const o=e.get(n+r);if(o){let t=Un[o.role];return o.color==="white"&&(t=t.toUpperCase()),o.promoted&&(t+="~"),t}else return"1"}).join("")).join("/").replace(/1{2,}/g,r=>r.length.toString())}function Xr(e,r){r.animation&&(ur(e.animation,r.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Jr(e,r){var n,o;if(!((n=r.movable)===null||n===void 0)&&n.dests&&(e.movable.dests=void 0),!((o=r.drawable)===null||o===void 0)&&o.autoShapes&&(e.drawable.autoShapes=[]),ur(e,r),r.fen&&(e.pieces=Yr(r.fen),e.drawable.shapes=[]),"check"in r&&Mn(e,r.check||!1),"lastMove"in r&&!r.lastMove?e.lastMove=void 0:r.lastMove&&(e.lastMove=r.lastMove),e.selected&&Gr(e,e.selected),Xr(e,r),!e.movable.rookCastle&&e.movable.dests){const t=e.movable.color==="white"?"1":"8",a="e"+t,s=e.movable.dests.get(a),f=e.pieces.get(a);if(!s||!f||f.role!=="king")return;e.movable.dests.set(a,s.filter(v=>!(v==="a"+t&&s.includes("c"+t))&&!(v==="h"+t&&s.includes("g"+t))))}}function ur(e,r){for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&(Object.prototype.hasOwnProperty.call(e,n)&&mr(e[n])&&mr(r[n])?ur(e[n],r[n]):e[n]=r[n])}function mr(e){if(typeof e!="object"||e===null)return!1;const r=Object.getPrototypeOf(e);return r===Object.prototype||r===null}const _e=(e,r)=>r.animation.enabled?Fn(e,r):pe(e,r);function pe(e,r){const n=e(r);return r.dom.redraw(),n}const je=(e,r)=>({key:e,pos:I(e),piece:r}),Wn=(e,r)=>r.sort((n,o)=>Le(e.pos,n.pos)-Le(e.pos,o.pos))[0];function Hn(e,r){const n=new Map,o=[],t=new Map,a=[],s=[],f=new Map;let v,p,b;for(const[g,E]of e)f.set(g,je(g,E));for(const g of or)v=r.pieces.get(g),p=f.get(g),v?p?Xe(v,p.piece)||(a.push(p),s.push(je(g,v))):s.push(je(g,v)):p&&a.push(p);for(const g of s)p=Wn(g,a.filter(E=>Xe(g.piece,E.piece))),p&&(b=[p.pos[0]-g.pos[0],p.pos[1]-g.pos[1]],n.set(g.key,b.concat(b)),o.push(p.key));for(const g of a)o.includes(g.key)||t.set(g.key,g.piece);return{anims:n,fadings:t}}function en(e,r){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const o=1-(r-n.start)*n.frequency;if(o<=0)e.animation.current=void 0,e.dom.redrawNow();else{const t=jn(o);for(const a of n.plan.anims.values())a[2]=a[0]*t,a[3]=a[1]*t;e.dom.redrawNow(!0),requestAnimationFrame((a=performance.now())=>en(e,a))}}function Fn(e,r){const n=new Map(r.pieces),o=e(r),t=Hn(n,r);if(t.anims.size||t.fadings.size){const a=r.animation.current&&r.animation.current.start;r.animation.current={start:performance.now(),frequency:1/r.animation.duration,plan:t},a||en(r,performance.now())}else r.dom.redraw();return o}const jn=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,zn=["green","red","blue","yellow"];function Gn(e,r){if(r.touches&&r.touches.length>1)return;r.stopPropagation(),r.preventDefault(),r.ctrlKey?Z(e):sr(e);const n=Ce(r),o=Pe(n,j(e),e.dom.bounds());!o||(e.drawable.current={orig:o,pos:n,brush:Xn(r),snapToValidMove:e.drawable.defaultSnapToValidMove},rn(e))}function rn(e){requestAnimationFrame(()=>{const r=e.drawable.current;if(r){const n=Pe(r.pos,j(e),e.dom.bounds());n||(r.snapToValidMove=!1);const o=r.snapToValidMove?$n(r.orig,r.pos,j(e),e.dom.bounds()):n;o!==r.mouseSq&&(r.mouseSq=o,r.dest=o!==r.orig?o:void 0,e.dom.redrawNow()),rn(e)}})}function Vn(e,r){e.drawable.current&&(e.drawable.current.pos=Ce(r))}function Zn(e){const r=e.drawable.current;r&&(r.mouseSq&&Jn(e.drawable,r),nn(e))}function nn(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Yn(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),on(e.drawable))}function Xn(e){var r;const n=(e.shiftKey||e.ctrlKey)&&Dr(e),o=e.altKey||e.metaKey||((r=e.getModifierState)===null||r===void 0?void 0:r.call(e,"AltGraph"));return zn[(n?1:0)+(o?2:0)]}function Jn(e,r){const n=t=>t.orig===r.orig&&t.dest===r.dest,o=e.shapes.find(n);o&&(e.shapes=e.shapes.filter(t=>!n(t))),(!o||o.brush!==r.brush)&&e.shapes.push(r),on(e)}function on(e){e.onChange&&e.onChange(e.shapes)}function eo(e,r){if(!r.isTrusted||r.button!==void 0&&r.button!==0||r.touches&&r.touches.length>1)return;const n=e.dom.bounds(),o=Ce(r),t=Pe(o,j(e),n);if(!t)return;const a=e.pieces.get(t),s=e.selected;!s&&e.drawable.enabled&&(e.drawable.eraseOnClick||!a||a.color!==e.turnColor)&&Yn(e),r.cancelable!==!1&&(!r.touches||e.blockTouchScroll||a||s||ro(e,o))&&r.preventDefault();const f=!!e.premovable.current,v=!!e.predroppable.current;e.stats.ctrlKey=r.ctrlKey,e.selected&&lr(e,e.selected,t)?_e(g=>Je(g,t),e):Je(e,t);const p=e.selected===t,b=an(e,t);if(a&&b&&p&&qn(e,t)){e.draggable.current={orig:t,piece:a,origPos:o,pos:o,started:e.draggable.autoDistance&&e.stats.dragged,element:b,previouslySelected:s,originTarget:r.target,keyHasChanged:!1},b.cgDragging=!0,b.classList.add("dragging");const g=e.dom.elements.ghost;g&&(g.className=`ghost ${a.color} ${a.role}`,ie(g,De(n)(I(t),j(e))),ir(g,!0)),fr(e)}else f&&me(e),v&&be(e);e.dom.redraw()}function ro(e,r){const n=j(e),o=e.dom.bounds(),t=Math.pow(o.width/8,2);for(const a of e.pieces.keys()){const s=Kr(a,n,o);if(Le(s,r)<=t)return!0}return!1}function no(e,r,n,o){const t="a0";e.pieces.set(t,r),e.dom.redraw();const a=Ce(n);e.draggable.current={orig:t,piece:r,origPos:a,pos:a,started:!0,element:()=>an(e,t),originTarget:n.target,newPiece:!0,force:!!o,keyHasChanged:!1},fr(e)}function fr(e){requestAnimationFrame(()=>{var r;const n=e.draggable.current;if(!n)return;!((r=e.animation.current)===null||r===void 0)&&r.plan.anims.has(n.orig)&&(e.animation.current=void 0);const o=e.pieces.get(n.orig);if(!o||!Xe(o,n.piece))Ue(e);else if(!n.started&&Le(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const a=n.element();if(!a)return;a.cgDragging=!0,a.classList.add("dragging"),n.element=a}const t=e.dom.bounds();ie(n.element,[n.pos[0]-t.left-t.width/16,n.pos[1]-t.top-t.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==Pe(n.pos,j(e),t))}fr(e)})}function oo(e,r){e.draggable.current&&(!r.touches||r.touches.length<2)&&(e.draggable.current.pos=Ce(r))}function to(e,r){const n=e.draggable.current;if(!n)return;if(r.type==="touchend"&&r.cancelable!==!1&&r.preventDefault(),r.type==="touchend"&&n.originTarget!==r.target&&!n.newPiece){e.draggable.current=void 0;return}me(e),be(e);const o=Ce(r)||n.pos,t=Pe(o,j(e),e.dom.bounds());t&&n.started&&n.orig!==t?n.newPiece?zr(e,n.orig,t,n.force):(e.stats.ctrlKey=r.ctrlKey,jr(e,n.orig,t)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!t&&(e.pieces.delete(n.orig),F(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===t||!t)?Z(e):e.selectable.enabled||Z(e),tn(e),e.draggable.current=void 0,e.dom.redraw()}function Ue(e){const r=e.draggable.current;r&&(r.newPiece&&e.pieces.delete(r.orig),e.draggable.current=void 0,Z(e),tn(e),e.dom.redraw())}function tn(e){const r=e.dom.elements;r.ghost&&ir(r.ghost,!1)}function an(e,r){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===r&&n.tagName==="PIECE")return n;n=n.nextSibling}}function io(e,r){e.exploding={stage:1,keys:r},e.dom.redraw(),setTimeout(()=>{br(e,2),setTimeout(()=>br(e,void 0),120)},120)}function br(e,r){e.exploding&&(r?e.exploding.stage=r:e.exploding=void 0,e.dom.redraw())}function ao(e,r){function n(){An(e),r()}return{set(o){o.orientation&&o.orientation!==e.orientation&&n(),Xr(e,o),(o.fen?_e:pe)(t=>Jr(t,o),e)},state:e,getFen:()=>Qn(e.pieces),toggleOrientation:n,setPieces(o){_e(t=>Tn(t,o),e)},selectSquare(o,t){o?_e(a=>Je(a,o,t),e):e.selected&&(Z(e),e.dom.redraw())},move(o,t){_e(a=>Hr(a,o,t),e)},newPiece(o,t){_e(a=>ar(a,o,t),e)},playPremove(){if(e.premovable.current){if(_e(Dn,e))return!0;e.dom.redraw()}return!1},playPredrop(o){if(e.predroppable.current){const t=Kn(e,o);return e.dom.redraw(),t}return!1},cancelPremove(){pe(me,e)},cancelPredrop(){pe(be,e)},cancelMove(){pe(o=>{sr(o),Ue(o)},e)},stop(){pe(o=>{gr(o),Ue(o)},e)},explode(o){io(e,o)},setAutoShapes(o){pe(t=>t.drawable.autoShapes=o,e)},setShapes(o){pe(t=>t.drawable.shapes=o,e)},getKeyAtDomPos(o){return Pe(o,j(e),e.dom.bounds())},redrawAll:r,dragNewPiece(o,t,a){no(e,o,t,a)},destroy(){gr(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function lo(){return{pieces:Yr(Zr),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:Cn()}}function er(e,r,n){const o=new Map,t=[];for(const f of e)o.set(f.hash,!1);let a=r.firstChild,s;for(;a;)s=a.getAttribute("cgHash"),o.has(s)?o.set(s,!0):t.push(a),a=a.nextSibling;for(const f of t)r.removeChild(f);for(const f of e)o.get(f.hash)||r.appendChild(n(f))}function J(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function co(e,r,n){const o=e.drawable,t=o.current,a=t&&t.mouseSq?t:void 0,s=new Map,f=e.dom.bounds(),v=o.autoShapes.filter(w=>!w.piece);for(const w of o.shapes.concat(v).concat(a?[a]:[]))w.dest&&s.set(w.dest,(s.get(w.dest)||0)+1);const p=o.shapes.concat(v).map(w=>({shape:w,current:!1,hash:wr(w,s,!1,f)}));a&&p.push({shape:a,current:!0,hash:wr(a,s,!0,f)});const b=p.map(w=>w.hash).join(";");if(b===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=b;const g=r.querySelector("defs"),E=r.querySelector("g"),N=n.querySelector("g");so(o,p,g),er(p.filter(w=>!w.shape.customSvg),E,w=>yr(e,w,o.brushes,s,f)),er(p.filter(w=>w.shape.customSvg),N,w=>yr(e,w,o.brushes,s,f))}function so(e,r,n){const o=new Map;let t;for(const f of r)f.shape.dest&&(t=e.brushes[f.shape.brush],f.shape.modifiers&&(t=ln(t,f.shape.modifiers)),o.set(t.key,t));const a=new Set;let s=n.firstChild;for(;s;)a.add(s.getAttribute("cgKey")),s=s.nextSibling;for(const[f,v]of o.entries())a.has(f)||n.appendChild(mo(v))}function wr({orig:e,dest:r,brush:n,piece:o,modifiers:t,customSvg:a},s,f,v){return[v.width,v.height,f,e,r,n,r&&(s.get(r)||0)>1,o&&uo(o),t&&fo(t),a&&po(a)].filter(p=>p).join(",")}function uo(e){return[e.color,e.role,e.scale].filter(r=>r).join(",")}function fo(e){return""+(e.lineWidth||"")}function po(e){let r=0;for(let n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n)>>>0;return"custom-"+r.toString()}function yr(e,{shape:r,current:n,hash:o},t,a,s){let f;const v=_r(I(r.orig),e.orientation);if(r.customSvg)f=ho(r.customSvg,v,s);else if(r.dest){let p=t[r.brush];r.modifiers&&(p=ln(p,r.modifiers)),f=go(p,v,_r(I(r.dest),e.orientation),n,(a.get(r.dest)||0)>1,s)}else f=vo(t[r.brush],v,n,s);return f.setAttribute("cgHash",o),f}function ho(e,r,n){const[o,t]=Qe(r,n),a=ge(J("g"),{transform:`translate(${o},${t})`}),s=ge(J("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return a.appendChild(s),s.innerHTML=e,a}function vo(e,r,n,o){const t=Qe(r,o),a=bo(),s=(o.width+o.height)/(4*Math.max(o.width,o.height));return ge(J("circle"),{stroke:e.color,"stroke-width":a[n?0:1],fill:"none",opacity:cn(e,n),cx:t[0],cy:t[1],r:s-a[1]/2})}function go(e,r,n,o,t,a){const s=yo(t&&!o),f=Qe(r,a),v=Qe(n,a),p=v[0]-f[0],b=v[1]-f[1],g=Math.atan2(b,p),E=Math.cos(g)*s,N=Math.sin(g)*s;return ge(J("line"),{stroke:e.color,"stroke-width":wo(e,o),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:cn(e,o),x1:f[0],y1:f[1],x2:v[0]-E,y2:v[1]-N})}function mo(e){const r=ge(J("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return r.appendChild(ge(J("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),r.setAttribute("cgKey",e.key),r}function ge(e,r){for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.setAttribute(n,r[n]);return e}function _r(e,r){return r==="white"?e:[7-e[0],7-e[1]]}function ln(e,r){return{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(r.lineWidth||e.lineWidth),key:[e.key,r.lineWidth].filter(n=>n).join("")}}function bo(){return[3/64,4/64]}function wo(e,r){return(e.lineWidth||10)*(r?.85:1)/64}function cn(e,r){return(e.opacity||1)*(r?.9:1)}function yo(e){return(e?20:10)/64}function Qe(e,r){const n=Math.min(1,r.width/r.height),o=Math.min(1,r.height/r.width);return[(e[0]-3.5)*n,(3.5-e[1])*o]}function _o(e,r){e.innerHTML="",e.classList.add("cg-wrap");for(const v of yn)e.classList.toggle("orientation-"+v,r.orientation===v);e.classList.toggle("manipulable",!r.viewOnly);const n=le("cg-container");e.appendChild(n);const o=le("cg-board");n.appendChild(o);let t,a,s;if(r.drawable.visible&&(t=ge(J("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),t.appendChild(J("defs")),t.appendChild(J("g")),a=ge(J("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),a.appendChild(J("g")),s=le("cg-auto-pieces"),n.appendChild(t),n.appendChild(a),n.appendChild(s)),r.coordinates){const v=r.orientation==="black"?" black":"",p=r.ranksPosition==="left"?" left":"";n.appendChild(Sr(nr,"ranks"+v+p)),n.appendChild(Sr(rr,"files"+v))}let f;return r.draggable.enabled&&r.draggable.showGhost&&(f=le("piece","ghost"),ir(f,!1),n.appendChild(f)),{board:o,container:n,wrap:e,ghost:f,svg:t,customSvg:a,autoPieces:s}}function Sr(e,r){const n=le("coords",r);let o;for(const t of e)o=le("coord"),o.textContent=t,n.appendChild(o);return n}function So(e,r){if(!e.dropmode.active)return;me(e),be(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const o=Ce(r),t=o&&Pe(o,j(e),e.dom.bounds());t&&zr(e,"a0",t)}e.dom.redraw()}function Co(e,r){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(r).observe(e.dom.elements.wrap),e.viewOnly)return;const o=ko(e);n.addEventListener("touchstart",o,{passive:!1}),n.addEventListener("mousedown",o,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",t=>t.preventDefault())}function Po(e,r){const n=[];if("ResizeObserver"in window||n.push(xe(document.body,"chessground.resize",r)),!e.viewOnly){const o=Cr(e,oo,Vn),t=Cr(e,to,Zn);for(const s of["touchmove","mousemove"])n.push(xe(document,s,o));for(const s of["touchend","mouseup"])n.push(xe(document,s,t));const a=()=>e.dom.bounds.clear();n.push(xe(document,"scroll",a,{capture:!0,passive:!0})),n.push(xe(window,"resize",a,{passive:!0}))}return()=>n.forEach(o=>o())}function xe(e,r,n,o){return e.addEventListener(r,n,o),()=>e.removeEventListener(r,n,o)}const ko=e=>r=>{e.draggable.current?Ue(e):e.drawable.current?nn(e):r.shiftKey||Dr(r)?e.drawable.enabled&&Gn(e,r):e.viewOnly||(e.dropmode.active?So(e,r):eo(e,r))},Cr=(e,r,n)=>o=>{e.drawable.current?e.drawable.enabled&&n(e,o):e.viewOnly||r(e,o)};function Eo(e){const r=j(e),n=De(e.dom.bounds()),o=e.dom.elements.board,t=e.pieces,a=e.animation.current,s=a?a.plan.anims:new Map,f=a?a.plan.fadings:new Map,v=e.draggable.current,p=To(e),b=new Set,g=new Set,E=new Map,N=new Map;let w,S,L,ee,$,ce,ke,G,Ee,B;for(S=o.firstChild;S;){if(w=S.cgKey,sn(S))if(L=t.get(w),$=s.get(w),ce=f.get(w),ee=S.cgPiece,S.cgDragging&&(!v||v.orig!==w)&&(S.classList.remove("dragging"),ie(S,n(I(w),r)),S.cgDragging=!1),!ce&&S.cgFading&&(S.cgFading=!1,S.classList.remove("fading")),L){if($&&S.cgAnimating&&ee===Ie(L)){const T=I(w);T[0]+=$[2],T[1]+=$[3],S.classList.add("anim"),ie(S,n(T,r))}else S.cgAnimating&&(S.cgAnimating=!1,S.classList.remove("anim"),ie(S,n(I(w),r)),e.addPieceZIndex&&(S.style.zIndex=ze(I(w),r)));ee===Ie(L)&&(!ce||!S.cgFading)?b.add(w):ce&&ee===Ie(ce)?(S.classList.add("fading"),S.cgFading=!0):Ge(E,ee,S)}else Ge(E,ee,S);else if(un(S)){const T=S.className;p.get(w)===T?g.add(w):Ge(N,T,S)}S=S.nextSibling}for(const[T,z]of p)if(!g.has(T)){Ee=N.get(z),B=Ee&&Ee.pop();const W=n(I(T),r);if(B)B.cgKey=T,ie(B,W);else{const U=le("square",z);U.cgKey=T,ie(U,W),o.insertBefore(U,o.firstChild)}}for(const[T,z]of t)if($=s.get(T),!b.has(T))if(ke=E.get(Ie(z)),G=ke&&ke.pop(),G){G.cgKey=T,G.cgFading&&(G.classList.remove("fading"),G.cgFading=!1);const W=I(T);e.addPieceZIndex&&(G.style.zIndex=ze(W,r)),$&&(G.cgAnimating=!0,G.classList.add("anim"),W[0]+=$[2],W[1]+=$[3]),ie(G,n(W,r))}else{const W=Ie(z),U=le("piece",W),se=I(T);U.cgPiece=W,U.cgKey=T,$&&(U.cgAnimating=!0,se[0]+=$[2],se[1]+=$[3]),ie(U,n(se,r)),e.addPieceZIndex&&(U.style.zIndex=ze(se,r)),o.appendChild(U)}for(const T of E.values())kr(e,T);for(const T of N.values())kr(e,T)}function Ao(e){const r=j(e),n=De(e.dom.bounds());let o=e.dom.elements.board.firstChild;for(;o;)(sn(o)&&!o.cgAnimating||un(o))&&ie(o,n(I(o.cgKey),r)),o=o.nextSibling}function Pr(e){var r,n;const o=e.dom.elements.wrap.getBoundingClientRect(),t=e.dom.elements.container,a=o.height/o.width,s=Math.floor(o.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,f=s*a;t.style.width=s+"px",t.style.height=f+"px",e.dom.bounds.clear(),(r=e.addDimensionsCssVarsTo)===null||r===void 0||r.style.setProperty("--cg-width",s+"px"),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("--cg-height",f+"px")}const sn=e=>e.tagName==="PIECE",un=e=>e.tagName==="SQUARE";function kr(e,r){for(const n of r)e.dom.elements.board.removeChild(n)}function ze(e,r){const o=e[1];return`${r?3+7-o:3+o}`}const Ie=e=>`${e.color} ${e.role}`;function To(e){var r;const n=new Map;if(e.lastMove&&e.highlight.lastMove)for(const a of e.lastMove)fe(n,a,"last-move");if(e.check&&e.highlight.check&&fe(n,e.check,"check"),e.selected&&(fe(n,e.selected,"selected"),e.movable.showDests)){const a=(r=e.movable.dests)===null||r===void 0?void 0:r.get(e.selected);if(a)for(const f of a)fe(n,f,"move-dest"+(e.pieces.has(f)?" oc":""));const s=e.premovable.dests;if(s)for(const f of s)fe(n,f,"premove-dest"+(e.pieces.has(f)?" oc":""))}const o=e.premovable.current;if(o)for(const a of o)fe(n,a,"current-premove");else e.predroppable.current&&fe(n,e.predroppable.current.key,"current-premove");const t=e.exploding;if(t)for(const a of t.keys)fe(n,a,"exploding"+t.stage);return n}function fe(e,r,n){const o=e.get(r);o?e.set(r,`${o} ${n}`):e.set(r,n)}function Ge(e,r,n){const o=e.get(r);o?o.push(n):e.set(r,[n])}function Mo(e,r){const o=e.drawable.autoShapes.filter(t=>t.piece).map(t=>({shape:t,hash:xo(t),current:!1}));er(o,r,t=>Oo(e,t,e.dom.bounds()))}function Ro(e){var r;const n=j(e),o=De(e.dom.bounds());let t=(r=e.dom.elements.autoPieces)===null||r===void 0?void 0:r.firstChild;for(;t;)qr(t,o(I(t.cgKey),n),t.cgScale),t=t.nextSibling}function Oo(e,{shape:r,hash:n},o){var t,a,s;const f=r.orig,v=(t=r.piece)===null||t===void 0?void 0:t.role,p=(a=r.piece)===null||a===void 0?void 0:a.color,b=(s=r.piece)===null||s===void 0?void 0:s.scale,g=le("piece",`${v} ${p}`);return g.setAttribute("cgHash",n),g.cgKey=f,g.cgScale=b,qr(g,De(o)(I(f),j(e)),b),g}const xo=e=>{var r,n,o;return[e.orig,(r=e.piece)===null||r===void 0?void 0:r.role,(n=e.piece)===null||n===void 0?void 0:n.color,(o=e.piece)===null||o===void 0?void 0:o.scale].join(",")};function Io(e,r){const n=lo();Jr(n,r||{});function o(){const t="dom"in n?n.dom.unbind:void 0,a=_o(e,n),s=Sn(()=>a.board.getBoundingClientRect()),f=b=>{Eo(p),a.autoPieces&&Mo(p,a.autoPieces),!b&&a.svg&&co(p,a.svg,a.customSvg)},v=()=>{Pr(p),Ao(p),a.autoPieces&&Ro(p)},p=n;return p.dom={elements:a,bounds:s,redraw:No(f),redrawNow:f,unbind:t},p.drawable.prevSvgHash="",Pr(p),f(!1),Co(p,v),t||(p.dom.unbind=Po(p,v)),p.events.insert&&p.events.insert(a),p}return ao(o(),o)}function No(e){let r=!1;return()=>{r||(r=!0,requestAnimationFrame(()=>{e(),r=!1}))}}const Lo=Or({__name:"Chessboard",props:{config:null},emits:["ready"],setup(e,{emit:r}){const{config:n}=e;let o=hn(null);function t(){let{value:a}=o;if(a){let s=a.parentElement;s.removeChild(a);let{width:f,height:v}=s.getBoundingClientRect();a.style.width=Math.min(f,v)+"px",a.style.height=Math.min(f,v)+"px",s.appendChild(a)}}return vn(()=>{if(o.value){t(),window.addEventListener("resize",t);let a=Io(o.value,n);r("ready",a)}}),gn(()=>{window.removeEventListener("resize",t)}),(a,s)=>(xr(),Ir(bn,{"explicit-height":"",flexbox:""},{nav:Ye(()=>[Nr(a.$slots,"nav",{},void 0,!0)]),default:Ye(()=>[mn("div",{ref_key:"boardEl",ref:o,class:"chessboard"},null,512)]),_:3}))}});var qo=pn(Lo,[["__scopeId","data-v-7122605e"]]);const Do="pnbrqkPNBRQK",Ve="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",Ko=["1-0","0-1","1/2-1/2","*"],Ze={b:[16,32,17,15],w:[-16,-32,-17,-15]},Er={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},$o=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Bo=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Uo={p:0,n:1,b:2,r:3,q:4,k:5},y={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},Qo=7,Wo=6,Ho=1,Fo=0,k={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},de={w:[{square:k.a1,flag:y.QSIDE_CASTLE},{square:k.h1,flag:y.KSIDE_CASTLE}],b:[{square:k.a8,flag:y.QSIDE_CASTLE},{square:k.h8,flag:y.KSIDE_CASTLE}]},jo=0,Ar=1;function zo(e,r){for(var n=e.from,o=e.to,t=e.piece,a=0,s=0,f=0,v=0,p=r.length;v<p;v++){var b=r[v].from,g=r[v].to,E=r[v].piece;t===E&&n!==b&&o===g&&(a++,ve(n)===ve(b)&&s++,qe(n)===qe(b)&&f++)}return a>0?s>0&&f>0?H(n):f>0?H(n).charAt(1):H(n).charAt(0):""}function Go(e){var r=e.charAt(0);if(r>="a"&&r<="h"){var n=e.match(/[a-h]\d.*[a-h]\d/);return n?void 0:oe}return r=r.toLowerCase(),r==="o"?Te:r}function Tr(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function ve(e){return e>>4}function qe(e){return e&15}function H(e){var r=qe(e),n=ve(e);return"abcdefgh".substring(r,r+1)+"87654321".substring(n,n+1)}function Ne(e){return e===te?he:te}function Vo(e){return"0123456789".indexOf(e)!==-1}function fn(e){var r=e instanceof Array?[]:{};for(var n in e)typeof n=="object"?r[n]=fn(e[n]):r[n]=e[n];return r}function Mr(e){return e.replace(/^\s+|\s+$/g,"")}const he="b",te="w",X=-1,oe="p",Rr="n",Be="b",Zo="r",Yo="q",Te="k",Xo=function(){for(var e=[],r=k.a8;r<=k.h1;r++){if(r&136){r+=7;continue}e.push(H(r))}return e}(),Jo={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},et=function(e){var r=new Array(128),n={w:X,b:X},o=te,t={w:0,b:0},a=X,s=0,f=1,v=[],p={},b={};w(typeof e=="undefined"?Ve:e);function g(i){typeof i=="undefined"&&(i=!1),r=new Array(128),n={w:X,b:X},o=te,t={w:0,b:0},a=X,s=0,f=1,v=[],i||(p={}),b={},$(L())}function E(){for(var i=[],l={},c=function(u){u in b&&(l[u]=b[u])};v.length>0;)i.push(ue());for(c(L());i.length>0;)ae(i.pop()),c(L());b=l}function N(){w(Ve)}function w(i,l){typeof l=="undefined"&&(l=!1);var c=i.split(/\s+/),u=c[0],h=0;if(!S(i).valid)return!1;g(l);for(var d=0;d<u.length;d++){var m=u.charAt(d);if(m==="/")h+=8;else if(Vo(m))h+=parseInt(m,10);else{var C=m<"a"?te:he;ke({type:m.toLowerCase(),color:C},H(h)),h++}}return o=c[1],c[2].indexOf("K")>-1&&(t.w|=y.KSIDE_CASTLE),c[2].indexOf("Q")>-1&&(t.w|=y.QSIDE_CASTLE),c[2].indexOf("k")>-1&&(t.b|=y.KSIDE_CASTLE),c[2].indexOf("q")>-1&&(t.b|=y.QSIDE_CASTLE),a=c[3]==="-"?X:k[c[3]],s=parseInt(c[4],10),f=parseInt(c[5],10),$(L()),!0}function S(i){var l={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"Illegal en-passant square"},c=i.split(/\s+/);if(c.length!==6)return{valid:!1,error_number:1,error:l[1]};if(isNaN(parseInt(c[5]))||parseInt(c[5],10)<=0)return{valid:!1,error_number:2,error:l[2]};if(isNaN(parseInt(c[4]))||parseInt(c[4],10)<0)return{valid:!1,error_number:3,error:l[3]};if(!/^(-|[abcdefgh][36])$/.test(c[3]))return{valid:!1,error_number:4,error:l[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(c[2]))return{valid:!1,error_number:5,error:l[5]};if(!/^(w|b)$/.test(c[1]))return{valid:!1,error_number:6,error:l[6]};var u=c[0].split("/");if(u.length!==8)return{valid:!1,error_number:7,error:l[7]};for(var h=0;h<u.length;h++){for(var d=0,m=!1,C=0;C<u[h].length;C++)if(isNaN(u[h][C])){if(!/^[prnbqkPRNBQK]$/.test(u[h][C]))return{valid:!1,error_number:9,error:l[9]};d+=1,m=!1}else{if(m)return{valid:!1,error_number:8,error:l[8]};d+=parseInt(u[h][C],10),m=!0}if(d!==8)return{valid:!1,error_number:10,error:l[10]}}return c[3][1]=="3"&&c[1]=="w"||c[3][1]=="6"&&c[1]=="b"?{valid:!1,error_number:11,error:l[11]}:{valid:!0,error_number:0,error:l[0]}}function L(){for(var i=0,l="",c=k.a8;c<=k.h1;c++){if(r[c]==null)i++;else{i>0&&(l+=i,i=0);var u=r[c].color,h=r[c].type;l+=u===te?h.toUpperCase():h.toLowerCase()}c+1&136&&(i>0&&(l+=i),c!==k.h1&&(l+="/"),i=0,c+=8)}var d="";t[te]&y.KSIDE_CASTLE&&(d+="K"),t[te]&y.QSIDE_CASTLE&&(d+="Q"),t[he]&y.KSIDE_CASTLE&&(d+="k"),t[he]&y.QSIDE_CASTLE&&(d+="q"),d=d||"-";var m=a===X?"-":H(a);return[l,o,d,m,s,f].join(" ")}function ee(i){for(var l=0;l<i.length;l+=2)typeof i[l]=="string"&&typeof i[l+1]=="string"&&(p[i[l]]=i[l+1]);return p}function $(i){v.length>0||(i!==Ve?(p.SetUp="1",p.FEN=i):(delete p.SetUp,delete p.FEN))}function ce(i){var l=r[k[i]];return l?{type:l.type,color:l.color}:null}function ke(i,l){if(!("type"in i&&"color"in i)||Do.indexOf(i.type.toLowerCase())===-1||!(l in k))return!1;var c=k[l];return i.type==Te&&!(n[i.color]==X||n[i.color]==c)?!1:(r[c]={type:i.type,color:i.color},i.type===Te&&(n[i.color]=c),$(L()),!0)}function G(i){var l=ce(i);return r[k[i]]=null,l&&l.type===Te&&(n[l.color]=X),$(L()),l}function Ee(i,l,c,u,h){var d={color:o,from:l,to:c,flags:u,piece:i[l].type};return h&&(d.flags|=y.PROMOTION,d.promotion=h),i[c]?d.captured=i[c].type:u&y.EP_CAPTURE&&(d.captured=oe),d}function B(i){function l(ne,Me,x,Q,Ae){if(ne[x].type===oe&&(ve(Q)===Fo||ve(Q)===Qo))for(var Re=[Yo,Zo,Be,Rr],ye=0,Oe=Re.length;ye<Oe;ye++)Me.push(Ee(ne,x,Q,Ae,Re[ye]));else Me.push(Ee(ne,x,Q,Ae))}var c=[],u=o,h=Ne(u),d={b:Ho,w:Wo},m=k.a8,C=k.h1,A=!1,O=typeof i!="undefined"&&"legal"in i?i.legal:!0,D=typeof i!="undefined"&&"piece"in i&&typeof i.piece=="string"?i.piece.toLowerCase():!0;if(typeof i!="undefined"&&"square"in i)if(i.square in k)m=C=k[i.square],A=!0;else return[];for(var _=m;_<=C;_++){if(_&136){_+=7;continue}var R=r[_];if(!(R==null||R.color!==u)){if(R.type===oe&&(D===!0||D===oe)){var P=_+Ze[u][0];if(r[P]==null){l(r,c,_,P,y.NORMAL);var P=_+Ze[u][1];d[u]===ve(_)&&r[P]==null&&l(r,c,_,P,y.BIG_PAWN)}for(M=2;M<4;M++){var P=_+Ze[u][M];P&136||(r[P]!=null&&r[P].color===h?l(r,c,_,P,y.CAPTURE):P===a&&l(r,c,_,a,y.EP_CAPTURE))}}else if(D===!0||D===R.type)for(var M=0,q=Er[R.type].length;M<q;M++)for(var Y=Er[R.type][M],P=_;P+=Y,!(P&136);){if(r[P]==null)l(r,c,_,P,y.NORMAL);else{if(r[P].color===u)break;l(r,c,_,P,y.CAPTURE);break}if(R.type==="n"||R.type==="k")break}}}if((D===!0||D===Te)&&(!A||C===n[u])){if(t[u]&y.KSIDE_CASTLE){var K=n[u],re=K+2;r[K+1]==null&&r[re]==null&&!z(h,n[u])&&!z(h,K+1)&&!z(h,re)&&l(r,c,n[u],re,y.KSIDE_CASTLE)}if(t[u]&y.QSIDE_CASTLE){var K=n[u],re=K-2;r[K-1]==null&&r[K-2]==null&&r[K-3]==null&&!z(h,n[u])&&!z(h,K-1)&&!z(h,re)&&l(r,c,n[u],re,y.QSIDE_CASTLE)}}if(!O)return c;for(var we=[],_=0,q=c.length;_<q;_++)ae(c[_]),W(u)||we.push(c[_]),ue();return we}function T(i,l){var c="";if(i.flags&y.KSIDE_CASTLE)c="O-O";else if(i.flags&y.QSIDE_CASTLE)c="O-O-O";else{if(i.piece!==oe){var u=zo(i,l);c+=i.piece.toUpperCase()+u}i.flags&(y.CAPTURE|y.EP_CAPTURE)&&(i.piece===oe&&(c+=H(i.from)[0]),c+="x"),c+=H(i.to),i.flags&y.PROMOTION&&(c+="="+i.promotion.toUpperCase())}return ae(i),U()&&(se()?c+="#":c+="+"),ue(),c}function z(i,l){for(var c=k.a8;c<=k.h1;c++){if(c&136){c+=7;continue}if(!(r[c]==null||r[c].color!==i)){var u=r[c],h=c-l,d=h+119;if($o[d]&1<<Uo[u.type]){if(u.type===oe){if(h>0){if(u.color===te)return!0}else if(u.color===he)return!0;continue}if(u.type==="n"||u.type==="k")return!0;for(var m=Bo[d],C=c+m,A=!1;C!==l;){if(r[C]!=null){A=!0;break}C+=m}if(!A)return!0}}}return!1}function W(i){return z(Ne(i),n[i])}function U(){return W(o)}function se(){return U()&&B().length===0}function We(){return!U()&&B().length===0}function He(){for(var i={},l=[],c=0,u=0,h=k.a8;h<=k.h1;h++){if(u=(u+1)%2,h&136){h+=7;continue}var d=r[h];d&&(i[d.type]=d.type in i?i[d.type]+1:1,d.type===Be&&l.push(u),c++)}if(c===2)return!0;if(c===3&&(i[Be]===1||i[Rr]===1))return!0;if(c===i[Be]+2){for(var m=0,C=l.length,h=0;h<C;h++)m+=l[h];if(m===0||m===C)return!0}return!1}function Fe(){for(var i=[],l={},c=!1;;){var u=ue();if(!u)break;i.push(u)}for(;;){var h=L().split(" ").slice(0,4).join(" ");if(l[h]=h in l?l[h]+1:1,l[h]>=3&&(c=!0),!i.length)break;ae(i.pop())}return c}function dn(i){v.push({move:i,kings:{b:n.b,w:n.w},turn:o,castling:{b:t.b,w:t.w},ep_square:a,half_moves:s,move_number:f})}function ae(i){var l=o,c=Ne(l);if(dn(i),r[i.to]=r[i.from],r[i.from]=null,i.flags&y.EP_CAPTURE&&(o===he?r[i.to-16]=null:r[i.to+16]=null),i.flags&y.PROMOTION&&(r[i.to]={type:i.promotion,color:l}),r[i.to].type===Te){if(n[r[i.to].color]=i.to,i.flags&y.KSIDE_CASTLE){var u=i.to-1,h=i.to+1;r[u]=r[h],r[h]=null}else if(i.flags&y.QSIDE_CASTLE){var u=i.to+1,h=i.to-2;r[u]=r[h],r[h]=null}t[l]=""}if(t[l]){for(var d=0,m=de[l].length;d<m;d++)if(i.from===de[l][d].square&&t[l]&de[l][d].flag){t[l]^=de[l][d].flag;break}}if(t[c]){for(var d=0,m=de[c].length;d<m;d++)if(i.to===de[c][d].square&&t[c]&de[c][d].flag){t[c]^=de[c][d].flag;break}}i.flags&y.BIG_PAWN?o==="b"?a=i.to-16:a=i.to+16:a=X,i.piece===oe||i.flags&(y.CAPTURE|y.EP_CAPTURE)?s=0:s++,o===he&&f++,o=Ne(o)}function ue(){var i=v.pop();if(i==null)return null;var l=i.move;n=i.kings,o=i.turn,t=i.castling,a=i.ep_square,s=i.half_moves,f=i.move_number;var c=o,u=Ne(o);if(r[l.from]=r[l.to],r[l.from].type=l.piece,r[l.to]=null,l.flags&y.CAPTURE)r[l.to]={type:l.captured,color:u};else if(l.flags&y.EP_CAPTURE){var h;c===he?h=l.to-16:h=l.to+16,r[h]={type:oe,color:u}}if(l.flags&(y.KSIDE_CASTLE|y.QSIDE_CASTLE)){var d,m;l.flags&y.KSIDE_CASTLE?(d=l.to+1,m=l.to-1):l.flags&y.QSIDE_CASTLE&&(d=l.to-2,m=l.to+1),r[d]=r[m],r[m]=null}return l}function dr(i,l){for(var c=Tr(i),u=0;u<2;u++){if(u==Ar){if(!l)return null;var h=!1,d=c.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(d){var m=d[1],C=d[2],A=d[3],O=d[4];C.length==1&&(h=!0)}else{var d=c.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/);if(d){var m=d[1],C=d[2],A=d[3],O=d[4];if(C.length==1)var h=!0}}}for(var D=Go(c),_=B({legal:!0,piece:m||D}),R=0,P=_.length;R<P;R++)switch(u){case jo:{if(c===Tr(T(_[R],_)))return _[R];break}case Ar:if(d){if((!m||m.toLowerCase()==_[R].piece)&&k[C]==_[R].from&&k[A]==_[R].to&&(!O||O.toLowerCase()==_[R].promotion))return _[R];if(h){var M=H(_[R].from);if((!m||m.toLowerCase()==_[R].piece)&&k[A]==_[R].to&&(C==M[0]||C==M[1])&&(!O||O.toLowerCase()==_[R].promotion))return _[R]}}}}return null}function Ke(i){var l=fn(i);l.san=T(l,B({legal:!0})),l.to=H(l.to),l.from=H(l.from);var c="";for(var u in y)y[u]&l.flags&&(c+=Jo[u]);return l.flags=c,l}function pr(i){for(var l=B({legal:!1}),c=0,u=o,h=0,d=l.length;h<d;h++){if(ae(l[h]),!W(u))if(i-1>0){var m=pr(i-1);c+=m}else c++;ue()}return c}return{load:function(i){return w(i)},reset:function(){return N()},moves:function(i){for(var l=B(i),c=[],u=0,h=l.length;u<h;u++)typeof i!="undefined"&&"verbose"in i&&i.verbose?c.push(Ke(l[u])):c.push(T(l[u],B({legal:!0})));return c},in_check:function(){return U()},in_checkmate:function(){return se()},in_stalemate:function(){return We()},in_draw:function(){return s>=100||We()||He()||Fe()},insufficient_material:function(){return He()},in_threefold_repetition:function(){return Fe()},game_over:function(){return s>=100||se()||We()||He()||Fe()},validate_fen:function(i){return S(i)},fen:function(){return L()},board:function(){for(var i=[],l=[],c=k.a8;c<=k.h1;c++)r[c]==null?l.push(null):l.push({square:H(c),type:r[c].type,color:r[c].color}),c+1&136&&(i.push(l),l=[],c+=8);return i},pgn:function(i){var l=typeof i=="object"&&typeof i.newline_char=="string"?i.newline_char:`
`,c=typeof i=="object"&&typeof i.max_width=="number"?i.max_width:0,u=[],h=!1;for(var d in p)u.push("["+d+' "'+p[d]+'"]'+l),h=!0;h&&v.length&&u.push(l);for(var m=function(M){var q=b[L()];if(typeof q!="undefined"){var Y=M.length>0?" ":"";M=`${M}${Y}{${q}}`}return M},C=[];v.length>0;)C.push(ue());var A=[],O="";for(C.length===0&&A.push(m(""));C.length>0;){O=m(O);var D=C.pop();if(!v.length&&D.color==="b"){const M=`${f}. ...`;O=O?`${O} ${M}`:M}else D.color==="w"&&(O.length&&A.push(O),O=f+".");O=O+" "+T(D,B({legal:!0})),ae(D)}if(O.length&&A.push(m(O)),typeof p.Result!="undefined"&&A.push(p.Result),c===0)return u.join("")+A.join(" ");for(var _=function(){return u.length>0&&u[u.length-1]===" "?(u.pop(),!0):!1},R=function(M,q){for(var Y of q.split(" "))if(!!Y){if(M+Y.length>c){for(;_();)M--;u.push(l),M=0}u.push(Y),M+=Y.length,u.push(" "),M++}return _()&&M--,M},P=0,d=0;d<A.length;d++){if(P+A[d].length>c&&A[d].includes("{")){P=R(P,A[d]);continue}P+A[d].length>c&&d!==0?(u[u.length-1]===" "&&u.pop(),u.push(l),P=0):d!==0&&(u.push(" "),P++),u.push(A[d]),P+=A[d].length}return u.join("")},load_pgn:function(i,l){var c=typeof l!="undefined"&&"sloppy"in l?l.sloppy:!1;function u(x){return x.replace(/\\/g,"\\")}function h(x,Q){for(var Ae=typeof Q=="object"&&typeof Q.newline_char=="string"?Q.newline_char:`\r?
`,Re={},ye=x.split(new RegExp(u(Ae))),Oe="",hr="",$e=0;$e<ye.length;$e++){var vr=/^\s*\[([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;Oe=ye[$e].replace(vr,"$1"),hr=ye[$e].replace(vr,"$2"),Mr(Oe).length>0&&(Re[Oe]=hr)}return Re}i=i.trim();var d=typeof l=="object"&&typeof l.newline_char=="string"?l.newline_char:`\r?
`,m=new RegExp("^(\\[((?:"+u(d)+")|.)*\\])(?:\\s*"+u(d)+"){2}"),C=m.test(i)?m.exec(i)[1]:"";N();var A=h(C,l),O="";for(var D in A)D.toLowerCase()==="fen"&&(O=A[D]),ee([D,A[D]]);if(c){if(O&&!w(O,!0))return!1}else if(A.SetUp==="1"&&!("FEN"in A&&w(A.FEN,!0)))return!1;for(var _=function(x){return Array.from(x).map(function(Q){return Q.charCodeAt(0)<128?Q.charCodeAt(0).toString(16):encodeURIComponent(Q).replace(/\%/g,"").toLowerCase()}).join("")},R=function(x){return x.length==0?"":decodeURIComponent("%"+x.match(/.{1,2}/g).join("%"))},P=function(x){return x=x.replace(new RegExp(u(d),"g")," "),`{${_(x.slice(1,x.length-1))}}`},M=function(x){if(x.startsWith("{")&&x.endsWith("}"))return R(x.slice(1,x.length-1))},q=i.replace(C,"").replace(new RegExp(`({[^}]*})+?|;([^${u(d)}]*)`,"g"),function(x,Q,Ae){return Q!==void 0?P(Q):" "+P(`{${Ae.slice(1)}}`)}).replace(new RegExp(u(d),"g")," "),Y=/(\([^\(\)]+\))+?/g;Y.test(q);)q=q.replace(Y,"");q=q.replace(/\d+\.(\.\.)?/g,""),q=q.replace(/\.\.\./g,""),q=q.replace(/\$\d+/g,"");var K=Mr(q).split(new RegExp(/\s+/));K=K.join(",").replace(/,,+/g,",").split(",");for(var re="",we="",ne=0;ne<K.length;ne++){var Me=M(K[ne]);if(Me!==void 0){b[L()]=Me;continue}if(re=dr(K[ne],c),re==null)if(Ko.indexOf(K[ne])>-1)we=K[ne];else return!1;else we="",ae(re)}return we&&Object.keys(p).length&&!p.Result&&ee(["Result",we]),!0},header:function(){return ee(arguments)},turn:function(){return o},move:function(i,l){var c=typeof l!="undefined"&&"sloppy"in l?l.sloppy:!1,u=null;if(typeof i=="string")u=dr(i,c);else if(typeof i=="object"){for(var h=B(),d=0,m=h.length;d<m;d++)if(i.from===H(h[d].from)&&i.to===H(h[d].to)&&(!("promotion"in h[d])||i.promotion===h[d].promotion)){u=h[d];break}}if(!u)return null;var C=Ke(u);return ae(u),C},undo:function(){var i=ue();return i?Ke(i):null},clear:function(){return g()},put:function(i,l){return ke(i,l)},get:function(i){return ce(i)},ascii(){for(var i=`   +------------------------+
`,l=k.a8;l<=k.h1;l++){if(qe(l)===0&&(i+=" "+"87654321"[ve(l)]+" |"),r[l]==null)i+=" . ";else{var c=r[l].type,u=r[l].color,h=u===te?c.toUpperCase():c.toLowerCase();i+=" "+h+" "}l+1&136&&(i+=`|
`,l+=8)}return i+=`   +------------------------+
`,i+="     a  b  c  d  e  f  g  h",i},remove:function(i){return G(i)},perft:function(i){return pr(i)},square_color:function(i){if(i in k){var l=k[i];return(ve(l)+qe(l))%2===0?"light":"dark"}return null},history:function(i){for(var l=[],c=[],u=typeof i!="undefined"&&("verbose"in i)&&i.verbose;v.length>0;)l.push(ue());for(;l.length>0;){var h=l.pop();u?c.push(Ke(h)):c.push(T(h,B({legal:!0}))),ae(h)}return c},get_comment:function(){return b[L()]},set_comment:function(i){b[L()]=i.replace("{","[").replace("}","]")},delete_comment:function(){var i=b[L()];return delete b[L()],i},get_comments:function(){return E(),Object.keys(b).map(function(i){return{fen:i,comment:b[i]}})},delete_comments:function(){return E(),Object.keys(b).map(function(i){var l=b[i];return delete b[i],{fen:i,comment:l}})}}},nt=Or({__name:"LegalMoveChessboard",props:{position:null,orientation:null,destinations:null},emits:["ready","move"],setup(e,{emit:r}){const{position:n,orientation:o="white",destinations:t}=e;async function a(g,E){if(g=="a0"||E=="a0"||!s)return;if(t){let S=s.state.pieces.get(g);S&&(s.state.pieces.delete(g),s.state.pieces.set(E,S)),f.load(`${s.getFen()} ${f.turn()=="w"?"b":"w"} - - 0 1`)}else f.move({from:g,to:E,promotion:"q"},{sloppy:!0});s.set({turnColor:f.turn()==="w"?"white":"black",fen:f.fen(),check:f.in_check(),lastMove:[g,E],movable:{color:f.turn()==="w"?"white":"black",dests:new Map}});let N;r("move",S=>N=S,f,s);let w=await N;w?setTimeout(()=>a(w.from,w.to)):s.set({movable:{dests:p()}})}let s,f=et(n),v={fen:f.fen().split(" ")[0],orientation:o,premovable:{enabled:!1},turnColor:f.turn()==="w"?"white":"black",movable:{free:!1,color:f.turn()==="w"?"white":"black",dests:new Map,events:{after:a}}};function p(){if(t)return t(f);let g=new Map;for(let E of Xo){let N=f.moves({square:E,verbose:!0});N.length&&g.set(E,N.map(({to:w})=>w))}return g}async function b(g){s=g,r("ready",s,f);let E;r("move",w=>E=w,f,s);let N=await E;N?setTimeout(()=>a(N.from,N.to)):s.set({turnColor:f.turn()==="w"?"white":"black",check:f.in_check(),movable:{color:f.turn()==="w"?"white":"black",dests:p()}})}return(g,E)=>(xr(),Ir(qo,{config:wn(v),onReady:b},{nav:Ye(()=>[Nr(g.$slots,"nav")]),_:3},8,["config"]))}});export{Xo as S,nt as _};
